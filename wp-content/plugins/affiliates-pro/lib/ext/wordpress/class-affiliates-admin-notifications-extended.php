<?php
/**
 * class-affiliates-admin-notifications-extended.php
 *
 * Copyright (c) 2016 "kento" Karim Rahimpur www.itthinx.com
 *
 * This code is released under the GNU General Public License.
 * See COPYRIGHT.txt and LICENSE.txt.
 *
 * This code is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * This header and all notices must be kept intact.
 *
 * @author Karim Rahimpur
 * @package affiliates-pro
 * @since affiliates-pro 2.16.0
 */

if ( !defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * Extended administrative section for notifications.
 */
class Affiliates_Admin_Notifications_Extended {

	const NONCE = 'aff-admin-menu';
	const SETTINGS = 'aff-settings';

	public static function view() { if ( !current_user_can( AFFILIATES_ADMINISTER_OPTIONS ) ) { wp_die( __( '拒絕訪問。', 'affiliates' ) ); } wp_enqueue_style( 'affiliates-pro-admin-notifications' ); $IX23581 = apply_filters( 'affiliates_notifications_sections', array( 'affiliates' => array ( 'label' => __( '附屬公司', 'affiliates' ), 'subsections' => array ( 'registration' => __( '登記', 'affiliates' ), 'referrals' => __( '推薦人', 'affiliates' ) ) ), 'administrator' => array ( 'label' => __( 'Administrator', 'affiliates' ), 'subsections' => array ( 'registration' => __('登記', 'affiliates' ), 'referrals' => __( '推薦人', 'affiliates' ) ) ) ) ); $IX57208 = isset( $_REQUEST['section'] ) ? $_REQUEST['section'] : null;
     //   if ( !key_exists( $IX57208, $IX23581 ) ) { $IX57208 = 'affiliates'; }
     //   $IX16461 = $IX23581[$IX57208]['label'];
    //    echo '<h1>'; echo __( 'Notifications', 'affiliates' ); echo '</h1>';
        $IX43577 = '';
        $IX57208 = "administrator";
        foreach( $IX23581 as $IX81570 => $IX34963 ) {
            //   $IX43577 .= sprintf( '<a class="section-link nav-tab %s" href="%s">%s</a>', $IX57208 == $IX81570 ? 'active nav-tab-active' : '', esc_url( add_query_arg( 'section', $IX81570, admin_url( 'admin.php?page=affiliates-admin-notifications' ) ) ), $IX34963['label'] ); } echo '<div class="section-links nav-tab-wrapper">'; echo $IX43577; echo '</div>'; include_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/includes/class-affiliates-notifications-extended.php' );
            switch ($IX57208) {
                case 'administrator' :
                    //  self::affiliates_notifications_administrator_section();
                    break;
                case 'affiliates' :
                default :
                    //self::affiliates_notifications_affiliates_section();
                    break;
            }
            
        }
    }

	protected static function affiliates_notifications_administrator_section() { $IX77313 = get_option( 'affiliates_notifications', null ); if ( $IX77313 === null ) { add_option( 'affiliates_notifications', array(), null, 'no' ); } if ( isset( $_POST['submit'] ) ) { if ( isset( $_POST[self::NONCE] ) && wp_verify_nonce( $_POST[self::NONCE], self::SETTINGS ) ) { if ( !empty( $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_SUBJECT] ) ) { $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_SUBJECT] = wp_filter_nohtml_kses( $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_SUBJECT] ); } else { $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_SUBJECT] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_ADMIN_REGISTRATION_PENDING_SUBJECT ); } if ( !empty( $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE] ) ) { $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE] = $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE]; } else { $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_ADMIN_REGISTRATION_PENDING_MESSAGE ); } if ( !empty( $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_SUBJECT] ) ) { $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_SUBJECT] = wp_filter_nohtml_kses( $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_SUBJECT] ); } else { $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_SUBJECT] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_ADMIN_REGISTRATION_ACTIVE_SUBJECT ); } if ( !empty( $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE] ) ) { $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE] = $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE]; } else { $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_ADMIN_REGISTRATION_ACTIVE_MESSAGE ); } $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN] = !empty( $_POST[Affiliates_Notifications_Extended::NOTIFY_ADMIN] ); if ( !empty( $_POST[Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL] ) ) { if ( $IX65574 = filter_var( $_POST[Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL], FILTER_VALIDATE_EMAIL ) ) { $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL] = $IX65574; } else { $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL] = ''; } } else { $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL] = ''; } $IX49193 = array(); if ( !empty( $_POST['notify_admin_status_accepted'] ) ) { $IX49193[] = AFFILIATES_REFERRAL_STATUS_ACCEPTED; } if ( !empty( $_POST['notify_admin_status_pending'] ) ) { $IX49193[] = AFFILIATES_REFERRAL_STATUS_PENDING; } $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN_STATUS] = $IX49193; if ( !empty( $_POST[Affiliates_Notifications_Extended::ADMIN_SUBJECT] ) ) { $IX77313[Affiliates_Notifications_Extended::ADMIN_SUBJECT] = wp_filter_nohtml_kses( $_POST[Affiliates_Notifications_Extended::ADMIN_SUBJECT] ); } else { $IX77313[Affiliates_Notifications_Extended::ADMIN_SUBJECT] = Affiliates_Notifications_Extended::ADMIN_DEFAULT_SUBJECT; } if ( !empty( $_POST[Affiliates_Notifications_Extended::ADMIN_MESSAGE] ) ) { $IX77313[Affiliates_Notifications_Extended::ADMIN_MESSAGE] = $_POST[Affiliates_Notifications_Extended::ADMIN_MESSAGE]; } else { $IX77313[Affiliates_Notifications_Extended::ADMIN_MESSAGE] = Affiliates_Notifications_Extended::ADMIN_DEFAULT_MESSAGE; } $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_ENABLED] = !empty( $_POST[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_ENABLED] ); update_option( 'affiliates_notifications', $IX77313 ); } } $IX78722 = isset( $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_ENABLED] ) ? $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_ENABLED] : Affiliates_Notifications_Extended::ADMIN_REGISTRATION_ENABLED_DEFAULT; $IX27011 = isset( $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_SUBJECT] ) ? $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_SUBJECT] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_ADMIN_REGISTRATION_ACTIVE_SUBJECT ); $IX59995 = isset( $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE] ) ? $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_ADMIN_REGISTRATION_ACTIVE_MESSAGE ); $IX33482 = isset( $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_SUBJECT] ) ? $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_SUBJECT] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_ADMIN_REGISTRATION_PENDING_SUBJECT ); $IX36775 = isset( $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE] ) ? $IX77313[Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_ADMIN_REGISTRATION_PENDING_MESSAGE ); $IX24056 = isset( $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN] ) && $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN]; $IX65574 = isset( $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL] ) ? $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL] : ''; $IX49193 = isset( $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN_STATUS] ) ? $IX77313[Affiliates_Notifications_Extended::NOTIFY_ADMIN_STATUS] : array( AFFILIATES_REFERRAL_STATUS_ACCEPTED ); $IX61331 = isset( $IX77313[Affiliates_Notifications_Extended::ADMIN_SUBJECT] ) ? $IX77313[Affiliates_Notifications_Extended::ADMIN_SUBJECT] : Affiliates_Notifications_Extended::ADMIN_DEFAULT_SUBJECT; $IX88410 = isset( $IX77313[Affiliates_Notifications_Extended::ADMIN_MESSAGE] ) ? $IX77313[Affiliates_Notifications_Extended::ADMIN_MESSAGE] : Affiliates_Notifications_Extended::ADMIN_DEFAULT_MESSAGE; echo '<form action="" name="notifications" method="post">'; echo '<div class="notifications">'; echo '<div class="manage">'; echo '<h1>' . __('登記', 'affiliates' ) . '</h1>'; echo '<div>' . '<p>' . '<label>' . '<input type="checkbox" name="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_ENABLED . '" id="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_ENABLED . '" ' . ( $IX78722 ? ' checked="checked" ' : '' ) . '/>' . __( 'Enable registration notifications', 'affiliates' ) . '</label>' . '</p>' . '<p class="description">' . __( 'Notify the administrator about new affiliate accounts.', 'affiliates' ) . '</p>' . '<h2>' . __( 'Administrator Notifications', 'affiliates' ) . '</h2>' . '<p>' . __( 'These templates are used to notify the site administrator of new affiliates.', 'affiliates' ) . '</p>' . '<h3>' . __('待辦的', 'affiliates' ) . '</h3>' . '<p>' . __( 'This notification is sent to the administrator if a new affiliate application is pending approval.', 'affiliates' ) . '</p>' . '<p>' . '<label>' . __( 'Subject', 'affiliates' ) . '<br/>' . '<input class="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_SUBJECT . '" name="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_SUBJECT . '" type="text" value="' . esc_attr( stripslashes( $IX33482 ) ) . '" />' . '</label>' . '</p>' . '<p>' . '<label> ' . __( 'Message', 'affiliates' ) . '<br/>' . '<textarea class="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE . '" id="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE . '" name="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_PENDING_MESSAGE . '" rows="10">' . htmlentities( stripslashes( $IX36775 ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</textarea>' . '</label>' . '<br/>' . '<span class="description">' . __( 'The format for this administrator notification is <strong>HTML</strong>.', 'affiliates' ) . '</span>' . '</p>' . '<h3>' . __( 'Active', 'affiliates' ) . '</h3>' . '<p>' . __( 'This notification is sent to the administrator if an affiliate has been approved automatically.', 'affiliates' ) . '</p>' . '<p>' . '<label>' . __( 'Subject', 'affiliates' ) . '<br/>' . '<input class="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_SUBJECT . '" name="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_SUBJECT . '" type="text" value="' . esc_attr( stripslashes( $IX27011 ) ) . '" />' . '</label>' . '</p>' . '<p>' . '<label> ' . __( 'Message', 'affiliates' ) . '<br/>' . '<textarea class="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE . '" id="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE . '" name="' . Affiliates_Notifications_Extended::ADMIN_REGISTRATION_MESSAGE . '" rows="10">' . htmlentities( stripslashes( $IX59995 ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</textarea>' . '</label>' . '<br/>' . '<span class="description">' . __( 'The format for this administrator notification is <strong>HTML</strong>.', 'affiliates' ) . '</span>' . '</p>' . wp_nonce_field( self::SETTINGS, self::NONCE, true, false ) . '<input class="button button-primary" type="submit" name="submit" value="' . __('節省', 'affiliates' ) . '"/>' . '</p>' . '</div>' . '</div>'; echo '</div>'; echo '<div class="notifications">'; echo '<div class="manage">'; echo '<h1>' . __( '推薦人', 'affiliates' ) . '</h1>'; echo '<p>' . __( 'Notifications for the site administrator can be enabled here. If the integration used provides its own notification settings, enable these through the integration&rsquo;s settings or here. Do not enable them both, as that could cause duplicate notifications to be sent.', 'affiliates' ) . '</p>'; echo '<div>' . '<h2>' . __( 'Referral Notifications', 'affiliates' ) . '</h2>' . '<p>' . '<label>' . '<input type="checkbox" name="' . Affiliates_Notifications_Extended::NOTIFY_ADMIN . '" id="' . Affiliates_Notifications_Extended::NOTIFY_ADMIN . '" ' . ( $IX24056 ? ' checked="checked" ' : '' ) . '/>' . __( 'Notify the site administrator', 'affiliates' ) . '</label>' . '</p>' . '<p class="description">' . __( 'Notifications will be sent to the email address specified in <em>Settings > General</em>, or if indicated, to the email address specified here.', 'affiliates' ) . '</p>' . '<p>' . '<label>' . __( 'Administrator Email Address', 'affiliates' ) . '<br/>' . sprintf( '<input class="%s" name="%s" type="text" value="%s" placeholder="%s"/>', esc_attr( Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL ), esc_attr( Affiliates_Notifications_Extended::NOTIFY_ADMIN_EMAIL ), esc_attr( $IX65574 ), get_bloginfo( 'admin_email' ) ) . '</label>' . '</p>' . '<p>' . __( 'Notify when a referral is:', 'affiliates' ) . ' ' . '<label>' . sprintf( '<input type="checkbox" name="notify_admin_status_accepted" %s />', in_array( AFFILIATES_REFERRAL_STATUS_ACCEPTED, $IX49193 ) ? ' checked="checked" ' : '' ) . __('已接受', 'affiliates' ) . '</label>' . ' ' . '<label>' . sprintf( '<input type="checkbox" name="notify_admin_status_pending" %s />', in_array( AFFILIATES_REFERRAL_STATUS_PENDING, $IX49193 ) ? ' checked="checked" ' : '' ) . __('待辦的', 'affiliates' ) . '</label>' . '</p>' . '<ul class="description">' . '<li>' . __( 'Notifications on referral status updates are only sent when the status changes from <em>pending</em> to <em>accepted</em>.', 'affiliates' ) . '</li>' . '<li>' . __( 'More than one notification may be sent if multiple statuses are enabled.', 'affiliates' ) . '</li>' . '<li>' . __( 'Notifications on referral status updates may not be supported by all integrations.', 'affiliates' ) . '</li>' . '</ul>' . '<p>' . '<label>' . __( 'Subject', 'affiliates' ) . '<br/>' . '<input class="' . Affiliates_Notifications_Extended::ADMIN_SUBJECT . '" name="' . Affiliates_Notifications_Extended::ADMIN_SUBJECT . '" type="text" value="' . esc_attr( stripslashes( $IX61331 ) ) . '" />' . '</label>' . '</p>' . '<p>' . '<label> ' . __( 'Message', 'affiliates' ) . '<br/>' . '<textarea class="message" id="' . Affiliates_Notifications_Extended::ADMIN_MESSAGE . '" name="' . Affiliates_Notifications_Extended::ADMIN_MESSAGE . '" rows="10">' . htmlentities( stripslashes( $IX88410 ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</textarea>' . '</label>' . '<br/>' . '<span class="description">' . __( 'The format for this administrator notification is <strong>HTML</strong>.', 'affiliates' ) . '</span>' . '</p>' . '<p>' . wp_nonce_field( self::SETTINGS, self::NONCE, true, false ) . '<input class="button button-primary" type="submit" name="submit" value="' . __('節省', 'affiliates' ) . '"/>' . '</p>' . '</div>' . '</div>'; echo '</div>'; echo '</form>'; }

	protected static function affiliates_notifications_affiliates_section() { $IX65419 = get_option( 'affiliates_notifications', null ); if ( $IX65419 === null ) { add_option('affiliates_notifications', array(), null, 'no' ); } if ( isset( $_POST['submit'] ) ) { if ( isset( $_POST[self::NONCE] ) && wp_verify_nonce( $_POST[self::NONCE], self::SETTINGS ) ) { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_ENABLED] = !empty( $_POST[Affiliates_Notifications_Extended::REGISTRATION_ENABLED] ); if ( !empty( $_POST[Affiliates_Notifications_Extended::REGISTRATION_SUBJECT] ) ) { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_SUBJECT] = wp_filter_nohtml_kses( $_POST[Affiliates_Notifications_Extended::REGISTRATION_SUBJECT] ); } else { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_SUBJECT] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_REGISTRATION_ACTIVE_SUBJECT ); } if ( !empty( $_POST[Affiliates_Notifications_Extended::REGISTRATION_MESSAGE] ) ) { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_MESSAGE] = $_POST[Affiliates_Notifications_Extended::REGISTRATION_MESSAGE]; } else { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_MESSAGE] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_REGISTRATION_ACTIVE_MESSAGE ); } if ( !empty( $_POST[Affiliates_Notifications_Extended::REGISTRATION_PENDING_SUBJECT] ) ) { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_PENDING_SUBJECT] = wp_filter_nohtml_kses( $_POST[Affiliates_Notifications_Extended::REGISTRATION_PENDING_SUBJECT] ); } else { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_PENDING_SUBJECT] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_REGISTRATION_PENDING_SUBJECT ); } if ( !empty( $_POST[Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE] ) ) { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE] = $_POST[Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE]; } else { $IX65419[Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_REGISTRATION_PENDING_MESSAGE ); } if ( !empty( $_POST[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_SUBJECT] ) ) { $IX65419[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_SUBJECT] = wp_filter_nohtml_kses( $_POST[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_SUBJECT] ); } else { $IX65419[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_SUBJECT] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_AFFILIATE_PENDING_TO_ACTIVE_SUBJECT ); } if ( !empty( $_POST[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE] ) ) { $IX65419[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE] = $_POST[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE]; } else { $IX65419[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE] = Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_AFFILIATE_PENDING_TO_ACTIVE_MESSAGE ); } $IX65419[Affiliates_Notifications_Extended::NOTIFY_AFFILIATE] = !empty( $_POST[Affiliates_Notifications_Extended::NOTIFY_AFFILIATE] ); $IX62523 = array(); if ( !empty( $_POST['notify_affiliate_status_accepted'] ) ) { $IX62523[] = AFFILIATES_REFERRAL_STATUS_ACCEPTED; } if ( !empty( $_POST['notify_affiliate_status_pending'] ) ) { $IX62523[] = AFFILIATES_REFERRAL_STATUS_PENDING; } $IX65419[Affiliates_Notifications_Extended::NOTIFY_AFFILIATE_STATUS] = $IX62523; if ( !empty( $_POST[Affiliates_Notifications_Extended::SUBJECT] ) ) { $IX65419[Affiliates_Notifications_Extended::SUBJECT] = wp_filter_nohtml_kses( $_POST[Affiliates_Notifications_Extended::SUBJECT] ); } else { $IX65419[Affiliates_Notifications_Extended::SUBJECT] = Affiliates_Notifications_Extended::DEFAULT_SUBJECT; } if ( !empty( $_POST[Affiliates_Notifications_Extended::MESSAGE] ) ) { $IX65419[Affiliates_Notifications_Extended::MESSAGE] = $_POST[Affiliates_Notifications_Extended::MESSAGE]; } else { $IX65419[Affiliates_Notifications_Extended::MESSAGE] = Affiliates_Notifications_Extended::DEFAULT_MESSAGE; } update_option( 'affiliates_notifications', $IX65419 ); } } $IX82563 = isset( $IX65419[Affiliates_Notifications_Extended::REGISTRATION_ENABLED] ) ? $IX65419[Affiliates_Notifications_Extended::REGISTRATION_ENABLED] : Affiliates_Notifications_Extended::REGISTRATION_ENABLED_DEFAULT; $IX25969 = isset( $IX65419[Affiliates_Notifications_Extended::REGISTRATION_SUBJECT] ) ? $IX65419[Affiliates_Notifications_Extended::REGISTRATION_SUBJECT] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_REGISTRATION_ACTIVE_SUBJECT ); $IX62557 = isset( $IX65419[Affiliates_Notifications_Extended::REGISTRATION_MESSAGE] ) ? $IX65419[Affiliates_Notifications_Extended::REGISTRATION_MESSAGE] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_REGISTRATION_ACTIVE_MESSAGE ); $IX93424 = isset( $IX65419[Affiliates_Notifications_Extended::REGISTRATION_PENDING_SUBJECT] ) ? $IX65419[Affiliates_Notifications_Extended::REGISTRATION_PENDING_SUBJECT] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_REGISTRATION_PENDING_SUBJECT ); $IX93084 = isset( $IX65419[Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE] ) ? $IX65419[Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_REGISTRATION_PENDING_MESSAGE ); $IX23543 = isset( $IX65419[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_SUBJECT] ) ? $IX65419[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_SUBJECT] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_AFFILIATE_PENDING_TO_ACTIVE_SUBJECT ); $IX74838 = isset( $IX65419[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE] ) ? $IX65419[Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE] : Affiliates_Notifications_Extended::get_default( Affiliates_Notifications_Extended::DEFAULT_AFFILIATE_PENDING_TO_ACTIVE_MESSAGE ); $IX39403 = isset( $IX65419[Affiliates_Notifications_Extended::NOTIFY_AFFILIATE] ) && $IX65419[Affiliates_Notifications_Extended::NOTIFY_AFFILIATE]; $IX62523 = isset( $IX65419[Affiliates_Notifications_Extended::NOTIFY_AFFILIATE_STATUS] ) ? $IX65419[Affiliates_Notifications_Extended::NOTIFY_AFFILIATE_STATUS] : array( AFFILIATES_REFERRAL_STATUS_ACCEPTED ); $IX22113 = isset( $IX65419[Affiliates_Notifications_Extended::SUBJECT] ) ? $IX65419[Affiliates_Notifications_Extended::SUBJECT] : Affiliates_Notifications_Extended::DEFAULT_SUBJECT; $IX70046 = isset( $IX65419[Affiliates_Notifications_Extended::MESSAGE] ) ? $IX65419[Affiliates_Notifications_Extended::MESSAGE] : Affiliates_Notifications_Extended::DEFAULT_MESSAGE; echo '<form action="" name="notifications" method="post">'; echo '<div class="notifications">'; echo '<div class="manage">'; echo '<h1>' . __('登記', 'affiliates' ) . '</h1>'; echo '<div>' . '<p>' . '<label>' . '<input type="checkbox" name="' . Affiliates_Notifications_Extended::REGISTRATION_ENABLED . '" id="' . Affiliates_Notifications_Extended::REGISTRATION_ENABLED . '" ' . ( $IX82563 ? ' checked="checked" ' : '' ) . '/>' . __( 'Enable registration emails', 'affiliates' ) . '</label>' . '</p>' . '<p class="description">' . __( 'Send new affiliates an email when their user account is created.', 'affiliates' ) . ' ' . __( 'This should normally be enabled, so that new affiliates receive their username and password to be able to log in and access their account.', 'affiliates' ) . '</p>' . '<h2>' . __( 'Affiliate Notifications', 'affiliates' ) . '</h2>' . '<p>' . __( 'These templates are used to notify affiliates.', 'affiliates' ) . '</p>' . '<h3>' . __('待辦的', 'affiliates' ) . '</h3>' . '<p>' . __( 'This notification is sent to new affiliates if their application is pending approval.', 'affiliates' ) . '</p>' . '<p>' . '<label>' . __( 'Subject', 'affiliates' ) . '<br/>' . '<input class="' . Affiliates_Notifications_Extended::REGISTRATION_PENDING_SUBJECT . '" name="' . Affiliates_Notifications_Extended::REGISTRATION_PENDING_SUBJECT . '" type="text" value="' . esc_attr( stripslashes( $IX93424 ) ) . '" />' . '</label>' . '</p>' . '<p>' . '<label> ' . __( 'Message', 'affiliates' ) . '<br/>' . '<textarea class="' . Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE . '" id="' . Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE . '" name="' . Affiliates_Notifications_Extended::REGISTRATION_PENDING_MESSAGE . '" rows="10">' . htmlentities( stripslashes( $IX93084 ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</textarea>' . '</label>' . '<br/>' . '<span class="description">' . __( 'The format for this affiliate notification is <strong>HTML</strong>.', 'affiliates' ) . '</span>' . '</p>' . '<h3>' . __( 'Active', 'affiliates' ) . '</h3>' . '<p>' . __( 'This notification is sent to new affiliates if they are approved automatically.', 'affiliates' ) . '</p>' . '<p>' . '<label>' . __( 'Subject', 'affiliates' ) . '<br/>' . '<input class="' . Affiliates_Notifications_Extended::REGISTRATION_SUBJECT . '" name="' . Affiliates_Notifications_Extended::REGISTRATION_SUBJECT . '" type="text" value="' . esc_attr( stripslashes( $IX25969 ) ) . '" />' . '</label>' . '</p>' . '<p>' . '<label> ' . __( 'Message', 'affiliates' ) . '<br/>' . '<textarea class="' . Affiliates_Notifications_Extended::REGISTRATION_MESSAGE . '" id="' . Affiliates_Notifications_Extended::REGISTRATION_MESSAGE . '" name="' . Affiliates_Notifications_Extended::REGISTRATION_MESSAGE . '" rows="10">' . htmlentities( stripslashes( $IX62557 ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</textarea>' . '</label>' . '<br/>' . '<span class="description">' . __( 'The format for this affiliate notification is <strong>HTML</strong>.', 'affiliates' ) . '</span>' . '</p>' . '<h3>' . __( 'Status changed from Pending to Active', 'affiliates' ) . '</h3>' . '<p>' . __( 'This notification is sent to affiliates once they are approved.', 'affiliates' ) . '</p>' . '<p>' . '<label>' . __( 'Subject', 'affiliates' ) . '<br/>' . '<input class="' . Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_SUBJECT . '" name="' . Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_SUBJECT . '" type="text" value="' . esc_attr( stripslashes( $IX23543 ) ) . '" />' . '</label>' . '</p>' . '<p>' . '<label> ' . __( 'Message', 'affiliates' ) . '<br/>' . '<textarea class="' . Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE . '" id="' . Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE . '" name="' . Affiliates_Notifications_Extended::AFFILIATE_PENDING_TO_ACTIVE_MESSAGE . '" rows="10">' . htmlentities( stripslashes( $IX74838 ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</textarea>' . '</label>' . '<br/>' . '<span class="description">' . __( 'The format for this affiliate notification is <strong>HTML</strong>.', 'affiliates' ) . '</span>' . '</p>' . '<p>' . wp_nonce_field( self::SETTINGS, self::NONCE, true, false ) . '<input class="button button-primary" type="submit" name="submit" value="' . __('節省', 'affiliates' ) . '"/>' . '</p>' . '</div>' . '</div>'; echo '</div>'; echo '<div class="notifications">'; echo '<div class="manage">'; echo '<h1>' . __( '推薦人', 'affiliates' ) . '</h1>'; echo '<p>' . __( 'Notifications for the affiliates can be enabled here. If the integration used provides its own notification settings, enable these through the integration&rsquo;s settings or here. Do not enable them both, as that could cause duplicate notifications to be sent.', 'affiliates' ) . '</p>'; echo '<div>' . '<h2>' . __( 'Referral Notifications', 'affiliates' ) . '</h2>' . '<p>' . '<label>' . '<input type="checkbox" name="' . Affiliates_Notifications_Extended::NOTIFY_AFFILIATE . '" id="' . Affiliates_Notifications_Extended::NOTIFY_AFFILIATE . '" ' . ( $IX39403 ? ' checked="checked" ' : '' ) . '/>' . __( 'Notify the affiliates', 'affiliates' ) . '</label>' . '</p>' . '<p class="description">' . __( 'Notifications will be sent to affiliates when credited with a referral.', 'affiliates' ) . '</p>' . '<p>' . __( 'Notify when a referral is:', 'affiliates' ) . ' ' . '<label>' . sprintf( '<input type="checkbox" name="notify_affiliate_status_accepted" %s />', in_array( AFFILIATES_REFERRAL_STATUS_ACCEPTED, $IX62523 ) ? ' checked="checked" ' : '' ) . __('已接受', 'affiliates' ) . '</label>' . ' ' . '<label>' . sprintf( '<input type="checkbox" name="notify_affiliate_status_pending" %s />', in_array( AFFILIATES_REFERRAL_STATUS_PENDING, $IX62523 ) ? ' checked="checked" ' : '' ) . __('待辦的', 'affiliates' ) . '</label>' . '</p>' . '<ul class="description">' . '<li>' . __( 'Notifications on referral status updates are only sent when the status changes from <em>pending</em> to <em>accepted</em>.', 'affiliates' ) . '</li>' . '<li>' . __( 'More than one notification may be sent if multiple statuses are enabled.', 'affiliates' ) . '</li>' . '<li>' . __( 'Notifications on referral status updates may not be supported by all integrations.', 'affiliates' ) . '</li>' . '</ul>' . '<p>' . '<label>' . __( 'Subject', 'affiliates' ) . '<br/>' . '<input class="' . Affiliates_Notifications_Extended::SUBJECT . '" name="' . Affiliates_Notifications_Extended::SUBJECT . '" type="text" value="' . esc_attr( stripslashes( $IX22113 ) ) . '" />' . '</label>' . '</p>' . '<p>' . '<label> ' . __( 'Message', 'affiliates' ) . '<br/>' . '<textarea class="' . Affiliates_Notifications_Extended::MESSAGE . '" id="' . Affiliates_Notifications_Extended::MESSAGE . '" name="' . Affiliates_Notifications_Extended::MESSAGE . '" rows="10">' . htmlentities( stripslashes( $IX70046 ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</textarea>' . '</label>' . '<br/>' . '<span class="description">' . __( 'The format for this affiliate notification is <strong>HTML</strong>.', 'affiliates' ) . '</span>' . '</p>' . '<p>' . wp_nonce_field( self::SETTINGS, self::NONCE, true, false ) . '<input class="button button-primary" type="submit" name="submit" value="' . __('節省', 'affiliates' ) . '"/>' . '</p>' . '</div>' . '</div>'; echo '</div>'; echo '</form>'; }

	public static function load_page() { $IX68751 = get_current_screen(); if ( isset( $IX68751->id ) ) { switch ( $IX68751->id ) { case 'affiliates_page_affiliates-admin-notifications' : $IX68751->add_help_tab( array( 'id' => 'affiliates-admin-notifications-affiliate-registration', 'title' => __('會員註冊', 'affiliates' ) , 'content' => self::get_notifications_help_affiliate_registration() ) ); $IX68751->add_help_tab( array( 'id' => 'affiliates-admin-notifications-referral-notifications', 'title' => __( 'Referral Notifications', 'affiliates' ) , 'content' => self::get_notifications_help_referral_notifications() ) ); break; } } }

	private static function get_notifications_help_affiliate_registration() { return '<div class="manage">' . '<h2>' . __( 'Affiliates Registration', 'affiliates' ) . '</h2>' . '<h3>' . __( 'Message format and tokens', 'affiliates' ) . '</h3>' . '<p class="description">' . __( '消息格式為 HTML，換行符必須用 <code><br/></code> 表示。', 'affiliates' ) . '<p class="description">' . __( 'These default tokens can be used in the subjects and the messages:', 'affiliates' ) . '<ul>' . '<li><code>[site_title]</code> : '. wp_specialchars_decode( get_bloginfo( 'blogname' ), ENT_QUOTES ) . '</li>' . '<li><code>[site_url]</code> : '. htmlentities( home_url(), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</li>' . '<li><code>[site_login_url]</code> : '. htmlentities( wp_login_url(), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</li>' . '<li><code>[username]</code> : ' . __( '新聯屬用戶帳戶的用戶名。', 'affiliates' ) . '</li>' . '<li><code>[password]</code> : '. __( '新聯屬用戶帳戶的密碼。', 'affiliates' ) . '</li>' . '<li><code>[user_id]</code> : '. __( '新聯屬用戶帳戶的 ID。 這是用戶 ID，而不是聯屬會員 ID。', 'affiliates' ) . '</li>' . '<li><code>[blogname]</code> : '. __( 'Same as [site_title].', 'affiliates' ) . '</li>' . '</ul>' . '</p>' . '<h3>' . __( 'Default subject and message', 'affiliates' ) . '</h4>' . '<p class="description">' . __( '主題:', 'affiliates' ) . '</p>' . '<pre>' . htmlentities( stripslashes( Affiliates_Notifications::get_default( Affiliates_Notifications::DEFAULT_REGISTRATION_ACTIVE_SUBJECT ) ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</pre>' . '<p class="description">' . __( 'Message:', 'affiliates' ) . '</p>' . '<pre>' . htmlentities( stripslashes( Affiliates_Notifications::get_default( Affiliates_Notifications::DEFAULT_REGISTRATION_ACTIVE_MESSAGE ) ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</pre>' . '</div>' . Affiliates_Admin_Menu_WordPress::get_help_tab_footer(); }

	private static function get_notifications_help_referral_notifications() { return '<div class="manage">' . '<h3>' . __( 'Message format and tokens', 'affiliates' ) . '</h3>' . '<p class="description">' . __( '消息格式為 HTML，換行符必須用 <code><br/></code> 表示。', 'affiliates' ) . '<p class="description">' . __( 'These default tokens can be used in the subjects and the messages:', 'affiliates' ) . '<ul>' . '<li><code>[site_title]</code> : '. wp_specialchars_decode( get_bloginfo( 'blogname' ), ENT_QUOTES ) . '</li>' . '<li><code>[site_url]</code> : '. htmlentities( home_url(), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</li>' . '<li><code>[affiliate_id]</code> : ' . __( '推薦會員的 ID', 'affiliates' ) . '</li>' . '<li><code>[affiliate_email]</code> : '. __( '推薦聯營公司的電子郵件地址', 'affiliates' ) . '</li>' . '<li><code>[affiliate_name]</code> : '. __( '引用的附屬機構名稱', 'affiliates' ) . '</li>' . '<li><code>[referral_status]</code> : '. __( '當前轉介狀態', 'affiliates' ) . '</li>' . '<li><code>[referral_amount]</code> : '. __( '推薦金額', 'affiliates' ) . '</li>' . '<li><code>[referral_currency_id]</code> : '. __( '推薦幣種ID', 'affiliates' ) . '</li>' . '<li><code>[referral_type]</code> : '. __( '推薦類型（內部參考）', 'affiliates' ) . '</li>' . '<li><code>[referral_reference]</code> : '. __( '推薦參考（通常與原始交易相關的內部參考）', 'affiliates' ) . '</li>' . '</ul>' . '</p>' . '<p class="description">' . __( 'Integration-specific data tokens can also be used in the subject and message.', 'affiliates' ) . '</p>' . '<h4>' . __( 'Default subjects and messages', 'affiliates' ) . '</h4>' . '<p class="description">' . __( 'Administrator subject:', 'affiliates' ) . '</p>' . '<pre>' . htmlentities( Affiliates_Notifications_Extended::ADMIN_DEFAULT_SUBJECT, ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</pre>' . '<p class="description">' . __( 'Administrator message:', 'affiliates' ) . '</p>' . '<pre>' . htmlentities( stripslashes( Affiliates_Notifications_Extended::ADMIN_DEFAULT_MESSAGE ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</pre>' . '<p class="description">' . __( 'Affiliate subject:', 'affiliates' ) . '</p>' . '<pre>' . htmlentities( Affiliates_Notifications_Extended::DEFAULT_SUBJECT, ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</pre>' . '<p class="description">' . __( 'Affiliate message:', 'affiliates' ) . '</p>' . '<pre>' . htmlentities( stripslashes( Affiliates_Notifications_Extended::DEFAULT_MESSAGE ), ENT_COMPAT, get_bloginfo( 'charset' ) ) . '</pre>' . '</div>' . Affiliates_Admin_Menu_WordPress::get_help_tab_footer(); }

}
