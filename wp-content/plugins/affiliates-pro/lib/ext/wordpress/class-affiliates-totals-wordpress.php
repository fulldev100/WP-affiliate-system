<?php
/**
 * class-affiliates-totals-wordpress.php
 *
 * Copyright 2011 "kento" Karim Rahimpur - www.itthinx.com
 *
 * This code is provided subject to the license granted.
 * Unauthorized use and distribution is prohibited.
 * See COPYRIGHT.txt and LICENSE.txt
 *
 * This code is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 *
 * This header and all notices must be kept intact.
 *
 * @author Karim Rahimpur
 * @package affiliates-pro
 * @since affiliates-pro 1.0.0
 */

if ( !defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * Totals platform-specific extension.
 */
class Affiliates_Totals_WordPress extends Affiliates_Totals {

	const NONCE       = 'totals-nonce';
	const NONCE_1     = 'totals-nonce-1';
	const NONCE_2     = 'totals-nonce-2';
	const SET_FILTERS = 'set-filters';
	const SET_RPP     = 'set-rpp';
	const SET_PAGE    = 'set-page';

	const NONCE_MP    = 'totals-nonce-mp';
	const MP_PAYPAL   = 'gen-mp-pp';

	const TOTALS_PER_PAGE = 10;

	public static function view() { global $wpdb, $wp_rewrite, $affiliates_options; global $affiliates_db; $IX56515 = ''; $IX56110 = date( 'Y-m-d', time() ); if ( !current_user_can( AFFILIATES_ACCESS_AFFILIATES ) ) { wp_die( __( '拒絕訪問。', 'affiliates' ) ); } if ( isset( $_POST['action'] ) ) { switch( $_POST['action'] ) { case 'do_foo' : break; } } else if ( isset ( $_GET['action'] ) ) { switch( $_GET['action'] ) { case 'close_referrals' : $IX12608 = array( 'tables' => array( 'referrals' => $affiliates_db->get_tablename( 'referrals' ), 'affiliates' => $affiliates_db->get_tablename( 'affiliates' ), 'affiliates_users' => $affiliates_db->get_tablename( 'affiliates_users' ), 'users' => $wpdb->users, ) ); $IX12608 = array_merge( $_GET, $IX12608 ); echo self::update_status( AFFILIATES_REFERRAL_STATUS_CLOSED, $IX12608 ); die(); break; } } if ( isset( $_POST['from_date'] ) || isset( $_POST['thru_date'] ) || isset( $_POST['minimum_total'] ) || isset( $_POST['affiliate_status'] ) || isset( $_POST['referral_status'] ) || isset( $_POST['currency_id'] ) || isset( $_POST['clear_filters'] ) || isset( $_POST['affiliate_id'] ) || isset( $_POST['affiliate_name'] ) || isset( $_POST['affiliate_user_login'] ) || isset( $_POST['show_deleted'] ) || isset( $_POST['show_inoperative'] ) ) { if ( !isset( $_POST[self::NONCE] ) || !wp_verify_nonce( $_POST[self::NONCE], self::SET_FILTERS ) ) { wp_die( __( '拒絕訪問。', 'affiliates' ) ); } } $IX23852 = $affiliates_options->get_option( 'totals_from_date', null ); $IX54303 = null; $IX89224 = $affiliates_options->get_option( 'totals_thru_date', null ); $IX69920 = null; $IX65845 = $affiliates_options->get_option( 'totals_minimum_total', null ); $IX33597 = $affiliates_options->get_option( 'totals_affiliate_status', null ); $IX66754 = $affiliates_options->get_option( 'totals_referral_status', null ); $IX19895 = $affiliates_options->get_option( 'totals_currency_id', null ); $IX65274 = $affiliates_options->get_option( 'totals_affiliate_id', null ); $IX35853 = $affiliates_options->get_option( 'totals_affiliate_name', null ); $IX36730 = $affiliates_options->get_option( 'totals_affiliate_user_login', null ); $IX87771 = $affiliates_options->get_option( 'totals_show_deleted', false ); $IX16008 = $affiliates_options->get_option( 'totals_show_inoperative', false ); if ( isset( $_POST['clear_filters'] ) ) { $affiliates_options->delete_option( 'totals_from_date' ); $affiliates_options->delete_option( 'totals_thru_date' ); $affiliates_options->delete_option( 'totals_minimum_total' ); $affiliates_options->delete_option( 'totals_affiliate_status' ); $affiliates_options->delete_option( 'totals_referral_status' ); $affiliates_options->delete_option( 'totals_currency_id' ); $affiliates_options->delete_option( 'totals_affiliate_id' ); $affiliates_options->delete_option( 'totals_affiliate_name' ); $affiliates_options->delete_option( 'totals_affiliate_user_login' ); $affiliates_options->delete_option( 'totals_show_deleted' ); $affiliates_options->delete_option( 'totals_show_inoperative' ); $IX23852 = null; $IX54303 = null; $IX89224 = null; $IX69920 = null; $IX65845 = null; $IX33597 = null; $IX66754 = null; $IX19895 = null; $IX65274 = null; $IX35853 = null; $IX36730 = null; $IX87771 = false; $IX16008 = false; } else if ( isset( $_POST['submitted'] ) ) { if ( !empty( $_POST['minimum_total'] ) ) { $IX65845 = Affiliates_Math::add( "0", $_POST['minimum_total'], affiliates_get_referral_amount_decimals() ); $affiliates_options->update_option( 'totals_minimum_total', $IX65845 ); } else { $IX65845 = null; $affiliates_options->delete_option( 'totals_minimum_total' ); } if ( !empty( $_POST['affiliate_status'] ) && ( $IX33597 = Affiliates_Utility::verify_affiliate_status( $_POST['affiliate_status'] ) ) ) { $affiliates_options->update_option( 'totals_affiliate_status', $IX33597 ); } else { $IX33597 = null; $affiliates_options->delete_option( 'totals_affiliate_status' ); } if ( !empty( $_POST['referral_status'] ) && ( $IX66754 = Affiliates_Utility::verify_referral_status_transition( $_POST['referral_status'], $_POST['referral_status'] ) ) ) { $affiliates_options->update_option( 'totals_referral_status', $IX66754 ); } else { $IX66754 = null; $affiliates_options->delete_option( 'totals_referral_status' ); } if ( !empty( $_POST['currency_id'] ) && ( $IX19895 = Affiliates_Utility::verify_currency_id( $_POST['currency_id'] ) ) ) { $affiliates_options->update_option( 'totals_currency_id', $IX19895 ); } else { $IX19895 = null; $affiliates_options->delete_option( 'totals_currency_id' ); } if ( !empty( $_POST['affiliate_name'] ) ) { $IX35853 = $_POST['affiliate_name']; $affiliates_options->update_option( 'totals_affiliate_name', $IX35853 ); } else { $IX35853 = null; $affiliates_options->delete_option( 'totals_affiliate_name' ); } if ( !empty( $_POST['affiliate_user_login'] ) ) { $IX36730 = $_POST['affiliate_user_login']; $affiliates_options->update_option( 'totals_affiliate_user_login', $IX36730 ); } else { $IX36730 = null; $affiliates_options->delete_option( 'totals_affiliate_user_login' ); } $IX87771 = isset( $_POST['show_deleted'] ); $affiliates_options->update_option( 'totals_show_deleted', $IX87771 ); $IX16008 = isset( $_POST['show_inoperative'] ); $affiliates_options->update_option( 'totals_show_inoperative', $IX16008 ); if ( !empty( $_POST['from_date'] ) ) { $IX23852 = date( 'Y-m-d', strtotime( $_POST['from_date'] ) ); $affiliates_options->update_option( 'totals_from_date', $IX23852 ); } else { $IX23852 = null; $affiliates_options->delete_option( 'totals_from_date' ); } if ( !empty( $_POST['thru_date'] ) ) { $IX89224 = date( 'Y-m-d', strtotime( $_POST['thru_date'] ) ); $affiliates_options->update_option( 'totals_thru_date', $IX89224 ); } else { $IX89224 = null; $affiliates_options->delete_option( 'totals_thru_date' ); } if ( $IX23852 && $IX89224 ) { if ( strtotime( $IX23852 ) > strtotime( $IX89224 ) ) { $IX89224 = null; $affiliates_options->delete_option( 'totals_thru_date' ); } } if ( !empty( $_POST['affiliate_id'] ) ) { $IX65274 = affiliates_check_affiliate_id( $_POST['affiliate_id'] ); if ( $IX65274 ) { $affiliates_options->update_option( 'totals_affiliate_id', $IX65274 ); } } else if ( isset( $_POST['affiliate_id'] ) ) { $IX65274 = null; $affiliates_options->delete_option( 'totals_affiliate_id' ); } } if ( isset( $_POST['row_count'] ) ) { if ( !isset( $_POST[self::NONCE_1] ) || !wp_verify_nonce( $_POST[self::NONCE_1], self::SET_RPP ) ) { wp_die( __( '拒絕訪問。', 'affiliates' ) ); } } if ( isset( $_POST['paged'] ) ) { if ( !isset( $_POST[self::NONCE_2] ) || !wp_verify_nonce( $_POST[self::NONCE_2], self::SET_PAGE ) ) { wp_die( __( '拒絕訪問。', 'affiliates' ) ); } } $IX79664 = ( is_ssl() ? 'https://' : 'http://' ) . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']; $IX79664 = remove_query_arg( 'paged', $IX79664 ); $IX79664 = remove_query_arg( 'action', $IX79664 ); $IX79664 = remove_query_arg( 'affiliate_id', $IX79664 ); $IX54423 = $affiliates_db->get_tablename( 'referrals' ); $IX70635 = $affiliates_db->get_tablename( 'affiliates' ); $IX75815 = $affiliates_db->get_tablename( 'affiliates_users' ); $IX56515 .= '<div class="totals">' . '<div>' . '<h1>' . __( 'Totals', 'affiliates' ) . '</h1>' . '</div>'; $IX40609 = isset( $_POST['row_count'] ) ? intval( $_POST['row_count'] ) : 0; if ($IX40609 <= 0) { $IX40609 = $affiliates_options->get_option( 'totals_per_page', self::TOTALS_PER_PAGE ); } else { $affiliates_options->update_option('totals_per_page', $IX40609 ); } $IX79195 = isset( $_GET['offset'] ) ? intval( $_GET['offset'] ) : 0; if ( $IX79195 < 0 ) { $IX79195 = 0; } $IX72756 = isset( $_REQUEST['paged'] ) ? intval( $_REQUEST['paged'] ) : 0; if ( $IX72756 < 0 ) { $IX72756 = 0; } $IX91922 = isset( $_GET['orderby'] ) ? $_GET['orderby'] : null; switch ( $IX91922 ) { case 'affiliate_id' : case 'name' : case 'user_login' : case 'email' : case 'total' : case 'currency_id' : break; default: $IX91922 = 'name'; } $IX90463 = isset( $_GET['order'] ) ? $_GET['order'] : null; switch ( $IX90463 ) { case 'asc' : case 'ASC' : $IX17152 = 'DESC'; break; case 'desc' : case 'DESC' : $IX17152 = 'ASC'; break; default: $IX90463 = 'ASC'; $IX17152 = 'DESC'; } $IX48969 = array( " 1=%d " ); $IX44079 = array( 1 ); if ( $IX65274 ) { $IX48969[] = " a.affiliate_id = %d "; $IX44079[] = $IX65274; } if ( $IX35853 ) { $IX48969[] = " a.name LIKE %s "; $IX44079[] = '%' . $affiliates_db->esc_like( $IX35853 ) . '%'; } if ( $IX36730 ) { $IX48969[] = " u.user_login LIKE %s "; $IX44079[] = '%' . $affiliates_db->esc_like( $IX36730 ) . '%'; } if ( $IX23852 ) { $IX54303 = DateHelper::u2s( $IX23852 ); } if ( $IX89224 ) { $IX69920 = DateHelper::u2s( $IX89224, 24*3600 ); } if ( $IX54303 && $IX69920 ) { $IX48969[] = " r.datetime >= %s AND r.datetime < %s "; $IX44079[] = $IX54303; $IX44079[] = $IX69920; } else if ( $IX54303 ) { $IX48969[] = " r.datetime >= %s "; $IX44079[] = $IX54303; } else if ( $IX69920 ) { $IX48969[] = " r.datetime < %s "; $IX44079[] = $IX69920; } if ( $IX33597 ) { $IX48969[] = " a.status = %s "; $IX44079[] = $IX33597; } if ( $IX66754 ) { $IX48969[] = " r.status = %s "; $IX44079[] = $IX66754; } if ( $IX19895 ) { $IX48969[] = " r.currency_id = %s "; $IX44079[] = $IX19895; } if ( !empty( $IX48969 ) ) { $IX48969 = " WHERE " . implode( " AND ", $IX48969 ); } else { $IX48969 = ''; } $IX45429 = ''; if ( $IX65845 ) { $IX45429 .= " HAVING SUM(r.amount) >= %s "; $IX44079[] = $IX65845; } $IX99694 = $affiliates_db->get_value( "
			SELECT COUNT(*) FROM (
			SELECT r.affiliate_id
			FROM $IX54423 r
			LEFT JOIN $IX70635 a ON r.affiliate_id = a.affiliate_id
			LEFT JOIN $IX75815 au ON a.affiliate_id = au.affiliate_id
			LEFT JOIN $wpdb->users u on au.user_id = u.ID
			$IX48969
			GROUP BY r.affiliate_id, r.currency_id
			$IX45429
			) tmp
			", $IX44079 ); if ( $IX99694 > $IX40609 ) { $IX25032 = true; } else { $IX25032 = false; } $IX27819 = ceil ( $IX99694 / $IX40609 ); if ( $IX72756 > $IX27819 ) { $IX72756 = $IX27819; } if ( $IX72756 != 0 ) { $IX79195 = ( $IX72756 - 1 ) * $IX40609; } $IX62106 = $affiliates_db->get_objects( "SELECT a.*, u.user_login, SUM(r.amount) AS total, r.currency_id " . "FROM $IX54423 r " . "LEFT JOIN $IX70635 a ON r.affiliate_id = a.affiliate_id " . "LEFT JOIN $IX75815 au ON a.affiliate_id = au.affiliate_id " . "LEFT JOIN $wpdb->users u on au.user_id = u.ID " . "$IX48969 " . "GROUP BY r.affiliate_id, r.currency_id " . "$IX45429 " . "ORDER BY $IX91922 $IX90463 LIMIT $IX40609 OFFSET $IX79195 ", $IX44079 ); $IX56527 = $affiliates_db->get_objects( "SELECT SUM(total) AS total, currency_id FROM (" . "SELECT SUM(r.amount) AS total, r.currency_id AS currency_id " . "FROM $IX54423 r " . "LEFT JOIN $IX70635 a ON r.affiliate_id = a.affiliate_id " . "LEFT JOIN $IX75815 au ON a.affiliate_id = au.affiliate_id " . "LEFT JOIN $wpdb->users u on au.user_id = u.ID " . "$IX48969 " . "GROUP BY r.affiliate_id, r.currency_id " . "$IX45429 " . ") tmp " . "GROUP BY currency_id", $IX44079 ); $IX49990 = array( 'affiliate_id' => __( 'Id', 'affiliates' ), 'name' => __('附屬機構', 'affiliates' ), 'email' => __('電子郵件', 'affiliates' ), 'user_login' => __('用戶名', 'affiliates' ), 'total' => __('全部的', 'affiliates' ), 'currency_id' => __('貨幣', 'affiliates' ) ); $IX56515 .= '<div class="totals-overview">'; $IX68246 = ""; if ( !empty( $IX23852 ) ) { $IX68246 .= "&from_date=" . urlencode( $IX23852 ); } if ( !empty( $IX89224 ) ) { $IX68246 .= "&thru_date=" . urlencode( $IX89224 ); } if ( !empty( $IX65845 ) ) { $IX68246 .= "&minimum_total=" . urlencode( $IX65845 ); } if ( !empty( $IX33597 ) ) { $IX68246 .= "&affiliate_status=" . urlencode( $IX33597 ); } if ( !empty( $IX66754 ) ) { $IX68246 .= "&referral_status=" . urlencode( $IX66754 ); } if ( !empty( $IX19895 ) ) { $IX68246 .= "&currency_id=" . urlencode( $IX19895 ); } if ( !empty( $IX65274 ) ) { $IX68246 .= "&affiliate_id=" . urlencode( $IX65274 ); } if ( !empty( $IX35853 ) ) { $IX68246 .= "&affiliate_name=" . urlencode( $IX35853 ); } if ( !empty( $IX36730 ) ) { $IX68246 .= "&affiliate_user_login=" . urlencode( $IX36730 ); } if ( !empty( $IX91922 ) ) { $IX68246 .= "&orderby=" . urlencode( $IX91922 ); } if ( !empty( $IX90463 ) ) { $IX68246 .= "&order=" . urlencode( $IX90463 ); } $IX60516 = esc_url( AFFILIATES_PRO_PLUGIN_URL . 'lib/ext/includes/generate-mass-payment-file.php' ); $IX56515 .= '<div class="manage">'; $IX56515 .= "<p>"; $IX56515 .= "<a target='_blank' title='" . __( '導出到文件', 'affiliates' ) . "' " . "class='button generate export' " . "href='" . $IX60516 . "?action=generate_mass_payment_file&service=export" . $IX68246 . "'>" . "<img class='icon' alt='" . __( 'Generate', 'affiliates') . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/export.png'/>" . "<span class='label'>" . __('出口', 'affiliates') . "</span>" . "</a>"; $IX56515 .= "<a target='_blank' title='" . __( 'Generate a Mass Payment File', 'affiliates' ) . "' " . "class='button generate paypal' " . "href='" . $IX60516 . "?action=generate_mass_payment_file&service=paypal" . $IX68246 . "'>" . "<img class='icon' alt='" . __( 'Generate', 'affiliates') . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/export.png'/>" . "<span class='label'>" . __( '批量付款文件', 'affiliates') . "</span>" . "</a>"; $IX56515 .= "<a title='" . __( '單擊以關閉這些推薦', 'affiliates' ) . "' " . "class='button close-referrals' " . "href='" . esc_url( $IX79664 ) . "&action=close_referrals" . $IX68246 . "'>" . "<img class='icon' alt='" . __( '密切推薦', 'affiliates') . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/closed.png'/>" . "<span class='label'>" . __('密切推薦', 'affiliates') . "</span>" . "</a>"; $IX56515 .= "</p>"; $IX56515 .= '<ul>'; $IX56515 .= '<li>'; $IX56515 .= __('<strong>導出</strong>：將當前總計列表導出到文件。', 'affiliates' ); $IX56515 .= '</li>'; $IX56515 .= '<li>'; $IX56515 .= __('<strong>批量付款文件</strong>：導出與 PayPal 文件格式兼容的批量付款當前總額<sup>*</sup>。', 'affiliates' ); $IX56515 .= '</li>'; $IX56515 .= '<li>'; $IX56515 .= '</ul>'; $IX56515 .= '<p style="font-size:0.92em">'; $IX56515 .= sprintf( __( "<sup>*</sup>請注意，PayPal 批量付款<a target='_blank' href='%s'>文件格式</a>僅允許每個批量付款文件使用一種貨幣類型。", 'affiliates' ), "https://www.paypal.com/cgi-bin/webscr?cmd=_batch-payment-format-outside" ); $IX56515 .= ' '; $IX56515 .= __( '使用<em>貨幣</em>過濾器將列表限制為一種貨幣。', 'affiliates' ); $IX56515 .= ' '; $IX56515 .= __( 'Where a specific PayPal email address is on file for an affiliate, it will be used.', 'affiliates' ); $IX56515 .= '</p>'; $IX56515 .= '</div>'; $IX28299 = array( AFFILIATES_AFFILIATE_STATUS_ACTIVE => __( 'Active', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_AFFILIATE_STATUS_PENDING => __('待辦的', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_AFFILIATE_STATUS_DELETED => __( 'Deleted', AFFILIATES_PLUGIN_DOMAIN ), ); $IX59672 = '<label class="affiliate-status-filter" for="affiliate_status">'; $IX59672 .= __('Affiliate Status', 'affiliates' ); $IX59672 .= ' '; $IX59672 .= '<select class="affiliate-status-filter" name="affiliate_status">'; $IX59672 .= '<option value="" ' . ( empty( $IX33597 ) ? ' selected="selected" ' : '' ) . '>--</option>'; foreach ( $IX28299 as $IX68034 => $IX36970 ) { $IX55174 = $IX68034 == $IX33597 ? ' selected="selected" ' : ''; $IX59672 .= '<option ' . $IX55174 . ' value="' . esc_attr( $IX68034 ) . '">' . $IX36970 . '</option>'; } $IX59672 .= '</select>'; $IX59672 .= '</label>'; $IX79176 = array( AFFILIATES_REFERRAL_STATUS_ACCEPTED => __('已接受', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_CLOSED => __('關閉', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_PENDING => __('待辦的', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_REJECTED => __('拒絕', AFFILIATES_PLUGIN_DOMAIN ), ); $IX41696 = '<label class="referral-status-filter" for="referral_status">'; $IX41696 .= __('Referral Status', 'affiliates' ); $IX41696 .= ' '; $IX41696 .= '<select class="referral-status-filter" name="referral_status">'; $IX41696 .= '<option value="" ' . ( empty( $IX66754 ) ? ' selected="selected" ' : '' ) . '>--</option>'; foreach ( $IX79176 as $IX68034 => $IX36970 ) { $IX55174 = $IX68034 == $IX66754 ? ' selected="selected" ' : ''; $IX41696 .= '<option ' . $IX55174 . ' value="' . esc_attr( $IX68034 ) . '">' . $IX36970 . '</option>'; } $IX41696 .= '</select>'; $IX41696 .= '</label>'; $IX36191 = $affiliates_db->get_objects( "SELECT DISTINCT(currency_id) FROM $IX54423 WHERE currency_id IS NOT NULL" ); $IX58229 = '<label class="currency-id-filter" for="currency_id">'; $IX58229 .= __('貨幣', 'affiliates' ); $IX58229 .= ' '; $IX58229 .= '<select class="currency-id-filter" name="currency_id">'; $IX58229 .= '<option value="" ' . ( empty( $IX19895 ) ? ' selected="selected" ' : '' ) . '>--</option>'; foreach ( $IX36191 as $IX47505 ) { $IX55174 = $IX47505->currency_id == $IX19895 ? ' selected="selected" ' : ''; $IX58229 .= '<option ' . $IX55174 . ' value="' . esc_attr( $IX47505->currency_id ) . '">' . $IX47505->currency_id . '</option>'; } $IX58229 .= '</select>'; $IX58229 .= '</label>'; $IX56515 .= '<div class="filters">' . '<label class="description" for="setfilters">' . __('過濾器', 'affiliates' ) . '</label>' . '<form id="setfilters" action="" method="post">' . '<div class="filter-section">' . $IX41696 . '<label class="minimum-total-filter" for="minimum_total">' . __( 'Minimum Total', 'affiliates' ) . '<input class="minimum-total-filter" name="minimum_total" type="text" value="' . esc_attr( $IX65845 ) . '"/>' . '</label>' . $IX58229 . $IX59672 . '</div>' . '<div class="filter-section">' . '<label class="affiliate-id-filter shrink" for="affiliate_id">' . __( 'Affiliate Id', 'affiliates' ) . '<input class="affiliate-id-filter" name="affiliate_id" type="text" value="' . esc_attr( $IX65274 ) . '"/>' . '</label>' . '<label class="affiliate-name-filter" for="affiliate_name">' . __( 'Affiliate Name', 'affiliates' ) . '<input class="affiliate-name-filter" name="affiliate_name" type="text" value="' . $IX35853 . '"/>' . '</label>' . '<label class="affiliate-user-login-filter" for="affiliate_user_login">' . __( 'Affiliate Username', 'affiliates' ) . '<input class="affiliate-user-login-filter" name="affiliate_user_login" type="text" value="' . $IX36730 . '" />' . '</label>' . '</div>' . '<div class="filter-section">' . '<label class="from-date-filter" for="from_date">' . __('從', 'affiliates' ) . '<input class="datefield from-date-filter" name="from_date" type="text" value="' . esc_attr( $IX23852 ) . '"/>'. '</label>' . '<label class="thru-date-filter" for="thru_date">' . __('直到', 'affiliates' ) . '<input class="datefield thru-date-filter" name="thru_date" type="text" class="datefield" value="' . esc_attr( $IX89224 ) . '"/>'. '</label>' . '</div>
					<div class="filter-buttons">' . wp_nonce_field( self::SET_FILTERS, self::NONCE, true, false ) . '<input class="button" type="submit" value="' . __('申請', 'affiliates' ) . '"/>' . '<input class="button" type="submit" name="clear_filters" value="' . __('清除', 'affiliates' ) . '"/>' . '<input type="hidden" value="submitted" name="submitted"/>' . '</div>' . '</form>' . '</div>'; $IX56515 .= '<div class="page-options">' . '<form id="setrowcount" action="" method="post">' . '<div>' . '<label for="row_count">' . __('每頁結果', 'affiliates' ) . '</label>' . '<input name="row_count" type="text" size="2" value="' . esc_attr( $IX40609 ) . '" />' . wp_nonce_field( self::SET_RPP, self::NONCE_1, true, false ) . '<input class="button" type="submit" value="' . __('申請', 'affiliates' ) . '"/>' . '</div>' . '</form>' . '</div>'; if ( $IX25032 ) { $IX74197 = new Affiliates_Pagination( $IX99694, null, $IX40609 ); $IX56515 .= '<form id="posts-filter" method="post" action="">'; $IX56515 .= '<div>'; $IX56515 .= wp_nonce_field( self::SET_PAGE, self::NONCE_2, true, false ); $IX56515 .= '</div>'; $IX56515 .= '<div class="tablenav top">'; $IX56515 .= $IX74197->pagination( 'top' ); $IX56515 .= '</div>'; $IX56515 .= '</form>'; } $IX56515 .= '<table class="wp-list-table widefat fixed" cellspacing="0">'; $IX56515 .= '<thead>'; $IX56515 .= '<tr>'; foreach ( $IX49990 as $IX68034 => $IX45635 ) { $IX41703 = array( 'orderby' => $IX68034, 'order' => $IX17152 ); $IX85474 = $IX68034; if ( !in_array($IX68034, array( 'edit', 'remove', 'links' ) ) ) { if ( strcmp( $IX68034, $IX91922 ) == 0 ) { $IX45541 = strtolower( $IX90463 ); $IX85474 = "$IX68034 manage-column sorted $IX45541"; } else { $IX85474 = "$IX68034 manage-column sortable"; } $IX45635 = '<a href="' . esc_url( add_query_arg( $IX41703, $IX79664 ) ) . '"><span>' . $IX45635 . '</span><span class="sorting-indicator"></span></a>'; } $IX56515 .= "<th scope='col' class='$IX85474'>$IX45635</th>"; } $IX56515 .= '</tr>'; $IX56515 .= '</thead>'; $IX56515 .= '<tbody>'; if ( count( $IX62106 ) > 0 ) { for ( $IX67823 = 0; $IX67823 < count( $IX62106 ); $IX67823++ ) { $IX20002 = $IX62106[$IX67823]; $IX11106 = ''; $IX26743 = ''; if ( $IX89051 = ( $IX20002->status !== null && strcmp( $IX20002->status, 'deleted' ) == 0 ) ) { $IX26743 = ' deleted '; $IX11106 .= " " . __('已刪除', 'affiliates' ); } $IX84482 = ''; if ( $IX61295 = ! ( ( $IX20002->from_date <= $IX56110 ) && ( $IX20002->thru_date == null || $IX20002->thru_date >= $IX56110 ) ) ) { $IX84482 = ' inoperative '; $IX11106 .= " " . __('無效', 'affiliates' ); } $IX56515 .= '<tr class="' . $IX26743 . $IX84482 . ( $IX67823 % 2 == 0 ? 'even' : 'odd' ) . '">'; $IX56515 .= '<td class="affiliate-id">'; if ( affiliates_encode_affiliate_id( $IX20002->affiliate_id ) != $IX20002->affiliate_id ) { $IX56515 .= '<span class="encoded-hint" title="' . affiliates_encode_affiliate_id( $IX20002->affiliate_id ) . '">' . $IX20002->affiliate_id . '</span>'; } else { $IX56515 .= $IX20002->affiliate_id; } $IX56515 .= '</td>'; $IX56515 .= sprintf( '<td class="affiliate-name">%s</td>', stripslashes( wp_filter_nohtml_kses( $IX20002->name ) ) . $IX11106 ); $IX56515 .= sprintf( '<td class="affiliate-email">%s</td>', esc_html( $IX20002->email ) ); $IX56515 .= sprintf( '<td class="affiliate-user-login">%s</td>', esc_html( $IX20002->user_login ) ); $IX56515 .= sprintf( '<td class="total">%s</td>', esc_html( affiliates_format_referral_amount( $IX20002->total, 'display' ) ) ); $IX56515 .= sprintf( '<td class="currency-id">%s</td>', esc_html( $IX20002->currency_id ) ); $IX56515 .= '</tr>'; } if ( is_array( $IX56527 ) && count( $IX56527 ) > 0 ) { foreach ( $IX56527 as $IX90249 ) { if ( !empty( $IX90249->currency_id ) && !empty( $IX90249->total ) ) { $IX56515 .= sprintf( '<tr style="font-weight: bold"><td colspan="4">%s %s</td><td class="total">%s</td><td class="currency-id">%s</td></tr>', esc_html__('全部的', 'affiliates' ), esc_html( $IX90249->currency_id ), esc_html( affiliates_format_referral_amount( $IX90249->total, 'display' ) ), esc_html( $IX90249->currency_id ) ); } } } } else { $IX56515 .= '<tr><td colspan="' . count( $IX49990 ) . '">' . __('沒有結果。', 'affiliates' ) . '</td></tr>'; } $IX56515 .= '</tbody>'; $IX56515 .= '</table>'; if ( $IX25032 ) { $IX74197 = new Affiliates_Pagination($IX99694, null, $IX40609); $IX56515 .= '<div class="tablenav bottom">'; $IX56515 .= $IX74197->pagination( 'bottom' ); $IX56515 .= '</div>'; } $IX56515 .= '</div>'; $IX56515 .= '</div>'; echo $IX56515;  }
}
