<?php
/**
 * class-affiliates-affiliates-wordpress.php
 *
 * Copyright 2011 "kento" Karim Rahimpur - www.itthinx.com
 *
 * This code is provided subject to the license granted.
 * Unauthorized use and distribution is prohibited.
 * See COPYRIGHT.txt and LICENSE.txt
 *
 * This code is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 *
 * This header and all notices must be kept intact.
 *
 * @author Karim Rahimpur
 * @package affiliates-pro
 * @since affiliates-pro 1.0.0
 */

if ( !defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * System-specific affiliates implementation.
 */
class Affiliates_Affiliates_WordPress extends Affiliates_Affiliates {

	public function view() {
        global $wpdb, $wp_rewrite, $affiliates_options;
        global $affiliates_db;
        $IX14171 = '';
        $IX58443 = date( 'Y-m-d', time() );
        $IX73859 = get_option( 'aff_pname', AFFILIATES_PNAME );
        if ( !current_user_can( AFFILIATES_ADMINISTER_AFFILIATES ) ) {
            wp_die( __( '拒絕訪問。', 'affiliates' ) );
        }
        $IX68204 = '';
        if ( isset( $_POST['action'] ) ) {
            $IX93536 = '';
            switch( $_POST['action'] ) {
                case 'add' :
                    $IX24605 = affiliates_admin_affiliates_add_submit();
                    if ( !empty( $IX24605['errors'] ) ) {
                        $_POST['errors'] = $IX24605['errors'];
                        return affiliates_admin_affiliates_add();
                    }
                    $IX93536 = __('已添加附屬機構。', 'affiliates' ); break;
               case 'edit' : $IX92485 = new Affiliates_Affiliate_WordPress(); $IX24605 = $IX92485->edit_submit();
               if ( !empty( $IX24605['errors'] ) ) { $_POST['errors'] = $IX24605['errors'];
                   return $IX92485->edit( $_POST['affiliate-id-field'] );
               }
               $IX93536 = __('附屬機構已更新。', 'affiliates' ); break;
               case 'remove' : affiliates_admin_affiliates_remove_submit();
               $IX93536 = __('附屬機構已刪除。', 'affiliates' ); break;
               case 'add-attribute' :
                   $IX68482 = new Affiliates_Attributes_WordPress();
                   if ( !$IX68482->add_submit() ) {
                       if ( isset( $_POST['affiliate_id'] ) ) {
                           return $IX68482->add( $_POST['affiliate_id' ] ); } }
                   else { $IX92485 = new Affiliates_Affiliate_WordPress();
                       return $IX92485->edit( $_POST['affiliate_id'] );
                   } break;
                   case 'edit-attribute' : $IX68482 = new Affiliates_Attributes_WordPress();
                   if ( !$IX68482->edit_submit() ) {
                       if ( isset( $_POST['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) {
                           return $IX68482->edit( $_POST['affiliate_id' ], $_GET['attr_key'] );
                       }
                   }
                   else {
                       $IX92485 = new Affiliates_Affiliate_WordPress();
                       return $IX92485->edit( $_POST['affiliate_id'] );
                   }
                   break;
                   case 'remove-attribute' :
                       $IX68482 = new Affiliates_Attributes_WordPress();
                       $IX68482->remove_submit();
                       $IX92485 = new Affiliates_Affiliate_WordPress();
                       return $IX92485->edit( $_POST['affiliate_id'] );
                       break;
                   case 'add-relation' :
                       break;
                   case 'edit-relation' :
                       break;
                   case 'remove-relation' :
                       break;
                  case 'affiliate-action' :
                      if ( isset( $_POST[AFFILIATES_ADMIN_AFFILIATES_ACTION_NONCE] ) && wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_ACTION_NONCE], 'admin' ) ) {
                          $IX47304 = isset( $_POST['affiliate_ids'] ) ? $_POST['affiliate_ids'] : null;
                          $IX79517 = null;
                          if ( isset( $_POST['bulk'] ) ) { $IX79517 = $_POST['bulk-action']; }
                          if ( is_array( $IX47304 ) && ( $IX79517 !== null ) ) {
                              foreach ( $IX47304 as $IX43379 ) {
                                  switch ( $IX79517 ) {
                                      case 'remove-affiliate' : $IX69288 = isset( $_POST['confirm'] ) ? true : false;
                                          if ( $IX69288 ) {
                                              affiliates_admin_affiliates_bulk_remove_submit();
                                          }
                                          else {
                                              return affiliates_admin_affiliates_bulk_remove();
                                          }
                                          break;
                                      case 'status-active' :
                                          affiliates_admin_affiliates_bulk_status_active_submit();
                                          break;
                                      case 'status-pending' :
                                          affiliates_admin_affiliates_bulk_status_pending_submit();
                                          break;
                                  }
                              }
                          }
                      }
                      $IX93536 = __('批量操作已執行', 'affiliates' ); break;
            }
            $IX68204 .= '<div class="updated">'; $IX68204 .= $IX93536; $IX68204 .= '</div>';
        }
        else if ( isset ( $_GET['action'] ) ) {
            switch( $_GET['action'] ) {
                case 'add' : return affiliates_admin_affiliates_add(); break;
                case 'edit' : if ( isset( $_GET['affiliate_id'] ) ) {
                    $IX92485 = new Affiliates_Affiliate_WordPress();
                    return $IX92485->edit( $_GET['affiliate_id'] ); } break;
                case 'remove' : if ( isset( $_GET['affiliate_id'] ) ) { return affiliates_admin_affiliates_remove(
                    $_GET['affiliate_id'] );
                }
                break;
                case 'add-attribute' :
                    $IX68482 = new Affiliates_Attributes_WordPress();
                    if ( isset( $_GET['affiliate_id'] ) ) {
                        return $IX68482->add( $_GET['affiliate_id' ] );
                    }
                    break;
               case 'edit-attribute' : $IX68482 = new Affiliates_Attributes_WordPress();
               if ( isset( $_GET['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) { return $IX68482->edit( $_GET['affiliate_id' ], $_GET['attr_key'] ); } break; case 'remove-attribute' : $IX68482 = new Affiliates_Attributes_WordPress(); if ( isset( $_GET['affiliate_id'] ) && isset( $_GET['attr_key'] ) ) { return $IX68482->remove( $_GET['affiliate_id' ], $_GET['attr_key'] ); } break; case 'add-relation' : break; case 'edit-relation' : break; case 'remove-relation' : break; } } if ( isset( $_POST['clear_filters'] ) || isset( $_POST['submitted'] ) ) { if ( !isset( $_POST[AFFILIATES_ADMIN_AFFILIATES_FILTER_NONCE] ) || !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_FILTER_NONCE], plugin_basename( __FILE__ ) ) ) { wp_die( __( '拒絕訪問。', 'affiliates' ) ); } } $IX51697 = $affiliates_options->get_option( 'affiliates_from_date', null ); $IX44650 = null; $IX44287 = $affiliates_options->get_option( 'affiliates_thru_date', null ); $IX13743 = null; $IX43379 = $affiliates_options->get_option( 'affiliates_affiliate_id', null ); $IX77117 = $affiliates_options->get_option( 'affiliates_affiliate_name', null ); $IX96089 = $affiliates_options->get_option( 'affiliates_affiliate_email', null ); $IX20815 = $affiliates_options->get_option( 'affiliates_affiliate_user_login', null ); $IX60065 = $affiliates_options->get_option( 'affiliates_show_active', true ); $IX20318 = $affiliates_options->get_option( 'affiliates_show_pending', true ); $IX82673 = $affiliates_options->get_option( 'affiliates_show_deleted', false ); $IX17928 = $affiliates_options->get_option( 'affiliates_show_inoperative', false ); $IX46674 = $affiliates_options->get_option( 'affiliates_show_totals', true ); if ( isset( $_POST['clear_filters'] ) ) { $affiliates_options->delete_option( 'affiliates_from_date' ); $affiliates_options->delete_option( 'affiliates_thru_date' ); $affiliates_options->delete_option( 'affiliates_affiliate_id' ); $affiliates_options->delete_option( 'affiliates_affiliate_name' ); $affiliates_options->delete_option( 'affiliates_affiliate_email' ); $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); $affiliates_options->delete_option( 'affiliates_show_deleted' ); $affiliates_options->delete_option( 'affiliates_show_inoperative' ); $affiliates_options->delete_option( 'affiliates_show_totals' ); $IX51697 = null; $IX44650 = null; $IX44287 = null; $IX13743 = null; $IX43379 = null; $IX77117 = null; $IX96089 = null; $IX20815 = null; $IX60065 = true; $IX20318 = true; $IX82673 = false; $IX17928 = false; $IX46674 = true; } else if ( isset( $_POST['submitted'] ) ) { if ( !empty( $_POST['affiliate_name'] ) ) { $IX77117 = trim( $_POST['affiliate_name'] ); if ( strlen( $IX77117 ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_name', $IX77117 ); } else { $IX77117 = null; $affiliates_options->delete_option( 'affiliates_affiliate_name' ); } } else { $IX77117 = null; $affiliates_options->delete_option( 'affiliates_affiliate_name' ); } if ( !empty( $_POST['affiliate_email'] ) ) { $IX96089 = trim( $_POST['affiliate_email'] ); if ( strlen( $IX96089 ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_email', $IX96089 ); } else { $IX96089 = null; $affiliates_options->delete_option( 'affiliates_affiliate_email' ); } } else { $IX96089 = null; $affiliates_options->delete_option( 'affiliates_affiliate_email' ); } if ( !empty( $_POST['affiliate_user_login'] ) ) { $IX20815 = trim( $_POST['affiliate_user_login'] ); if ( strlen( $IX20815 ) > 0 ) { $affiliates_options->update_option( 'affiliates_affiliate_user_login', $IX20815 ); } else { $IX20815 = null; $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); } } else { $IX20815 = null; $affiliates_options->delete_option( 'affiliates_affiliate_user_login' ); } $IX60065 = isset( $_POST['show_active'] ); $affiliates_options->update_option( 'affiliates_show_active', $IX60065 ); $IX20318 = isset( $_POST['show_pending'] ); $affiliates_options->update_option( 'affiliates_show_pending', $IX20318 ); $IX82673 = isset( $_POST['show_deleted'] ); $affiliates_options->update_option( 'affiliates_show_deleted', $IX82673 ); $IX17928 = isset( $_POST['show_inoperative'] ); $affiliates_options->update_option( 'affiliates_show_inoperative', $IX17928 ); $IX46674 = isset( $_POST['show_totals'] ); $affiliates_options->update_option( 'affiliates_show_totals', $IX46674 ); if ( !empty( $_POST['from_date'] ) ) { $IX51697 = date( 'Y-m-d', strtotime( $_POST['from_date'] ) ); $affiliates_options->update_option( 'affiliates_from_date', $IX51697 ); } else { $affiliates_options->delete_option( 'affiliates_from_date' ); } if ( !empty( $_POST['thru_date'] ) ) { $IX44287 = date( 'Y-m-d', strtotime( $_POST['thru_date'] ) ); $affiliates_options->update_option( 'affiliates_thru_date', $IX44287 ); } else { $affiliates_options->delete_option( 'affiliates_thru_date' ); } if ( $IX51697 && $IX44287 ) { if ( strtotime( $IX51697 ) > strtotime( $IX44287 ) ) { $IX44287 = null; $affiliates_options->delete_option( 'affiliates_thru_date' ); } } if ( $IX51697 ) { $IX44650 = DateHelper::u2s( $IX51697 ); } if ( $IX44287 ) { $IX13743 = DateHelper::u2s( $IX44287, 24*3600 ); } if ( !empty( $_POST['affiliate_id'] ) ) { $IX43379 = affiliates_check_affiliate_id( $_POST['affiliate_id'] ); if ( $IX43379 ) { $affiliates_options->update_option( 'affiliates_affiliate_id', $IX43379 ); } } else if ( isset( $_POST['affiliate_id'] ) ) { $IX43379 = null; $affiliates_options->delete_option( 'affiliates_affiliate_id' ); } } if ( isset( $_POST['row_count'] ) ) { if ( !isset( $_POST[AFFILIATES_ADMIN_AFFILIATES_NONCE_1] ) || !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_NONCE_1], plugin_basename( __FILE__ ) ) ) { wp_die( __( '拒絕訪問。', 'affiliates' ) ); } } if ( isset( $_POST['paged'] ) ) { if ( !isset( $_POST[AFFILIATES_ADMIN_AFFILIATES_NONCE_2] ) || !wp_verify_nonce( $_POST[AFFILIATES_ADMIN_AFFILIATES_NONCE_2], plugin_basename( __FILE__ ) ) ) { wp_die( __( '拒絕訪問。', 'affiliates' ) ); } } $IX67176 = ( is_ssl() ? 'https://' : 'http://' ) . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']; $IX67176 = remove_query_arg( 'paged', $IX67176 ); $IX67176 = remove_query_arg( 'action', $IX67176 ); $IX67176 = remove_query_arg( 'affiliate_id', $IX67176 ); $IX31703 = _affiliates_get_tablename( 'affiliates' ); $IX17212 = _affiliates_get_tablename( 'affiliates_users' ); $IX31307 = _affiliates_get_tablename( 'affiliates_attributes' );
        $IX14171 .= '<div class="manage-affiliates">' . '<h1>' . __( '管理附屬公司', 'affiliates' ) . '</h1>'; $IX14171 .= $IX68204; $IX51491 = $affiliates_options->get_option( 'show_filters', true ); $IX77293 = $affiliates_options->get_option( 'show_columns', true ); $IX14171 .= '<div class="manage">'; $IX14171 .= "<a title='" . __('點擊添加新會員', 'affiliates' ) . "' class='button add' href='" . esc_url( $IX67176 ) . "&action=add'><img class='icon' alt='" . __('添加', 'affiliates') . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/add.png'/><span class='label'>" . __('新會員', 'affiliates') . "</span></a>"; $IX14171 .= '<div style="float:right">'; $IX14171 .= '<div style="display:inline">'; $IX14171 .= '<form style="display:inline" id="export-affiliates" action="" method="post">'; $IX14171 .= sprintf( '<input class="button" type="submit" value="%s" />', __('出口', 'affiliates' ) ); $IX14171 .= '<input type="hidden" name="action" value="export" />'; $IX14171 .= wp_nonce_field( 'export-affiliates', 'export-nonce', true, false ); $IX14171 .= '</form>'; $IX14171 .= '</div>'; $IX14171 .= ' '; $IX14171 .= sprintf( '<div class="button toggle-button %s" id="filters-toggle">', ( $IX51491 ? 'on' : 'off' ) ); $IX14171 .= __('過濾器', 'affiliates' ); $IX14171 .= '</div>'; $IX14171 .= ' '; $IX14171 .= sprintf( '<div class="button toggle-button %s" id="columns-toggle">', ( $IX77293 ? 'on' : 'off' ) ); $IX14171 .= __( '列', 'affiliates' ); $IX14171 .= '</div>'; $IX14171 .= '</div>'; $IX14171 .= '</div>'; $IX75088 = isset( $_POST['row_count'] ) ? intval( $_POST['row_count'] ) : 0; if ($IX75088 <= 0) { $IX75088 = $affiliates_options->get_option( 'affiliates_per_page', AFFILIATES_AFFILIATES_PER_PAGE ); } else { $affiliates_options->update_option('affiliates_per_page', $IX75088 ); } $IX25338 = isset( $_REQUEST['paged'] ) ? intval( $_REQUEST['paged'] ) : 1; if ( $IX25338 < 1 ) { $IX25338 = 1; } $IX68672 = isset( $_GET['orderby'] ) ? $_GET['orderby'] : null; switch ( $IX68672 ) { case 'from_date' : case 'thru_date' : case 'email' : case 'affiliate_id' : case 'name' : case 'user_login' : break; default: $IX68672 = 'name'; } $IX82325 = isset( $_GET['order'] ) ? $_GET['order'] : null; switch ( $IX82325 ) { case 'asc' : case 'ASC' : $IX78998 = 'DESC'; break; case 'desc' : case 'DESC' : $IX78998 = 'ASC'; break; default: $IX82325 = 'ASC'; $IX78998 = 'DESC'; } $IX78748 = array( " 1=%d " ); $IX24517 = array( 1 ); if ( $IX43379 ) { $IX78748[] = " $IX31703.affiliate_id = %d "; $IX24517[] = $IX43379; } if ( $IX77117 ) { $IX78748[] = " $IX31703.name LIKE %s "; $IX24517[] = '%' . $wpdb->esc_like( $IX77117 ) . '%'; } if ( $IX96089 ) { $IX78748[] = " $IX31703.email LIKE %s "; $IX24517[] = '%' . $wpdb->esc_like( $IX96089 ) . '%'; } if ( $IX20815 ) { $IX78748[] = " $wpdb->users.user_login LIKE %s "; $IX24517[] = '%' . $wpdb->esc_like( $IX20815 ) . '%'; } $IX69255 = array( '' ); if ( $IX60065 ) { $IX69255[] = 'active'; } if ( $IX20318 ) { $IX69255[] = 'pending'; } if ( $IX82673 ) { $IX69255[] = 'deleted'; } $IX78748[] = sprintf( " $IX31703.status IN (%s) ", !empty($IX69255) ? "'" . implode( "','", $IX69255 ) . "'" : '' ); if ( !$IX17928 ) { $IX78748[] = " $IX31703.from_date <= %s AND ( $IX31703.thru_date IS NULL OR $IX31703.thru_date >= %s ) "; $IX24517[] = $IX58443; $IX24517[] = $IX58443; } if ( $IX44650 && $IX13743 ) { $IX78748[] = " $IX31703.from_date >= %s AND ( $IX31703.thru_date IS NULL OR $IX31703.thru_date < %s ) "; $IX24517[] = $IX44650; $IX24517[] = $IX13743; } else if ( $IX44650 ) { $IX78748[] = " $IX31703.from_date >= %s "; $IX24517[] = $IX44650; } else if ( $IX13743 ) { $IX78748[] = " $IX31703.thru_date < %s "; $IX24517[] = $IX13743; } if ( !empty( $IX78748 ) ) { $IX78748 = " WHERE " . implode( " AND ", $IX78748 ); } else { $IX78748 = ''; } do { $IX21608 = false; $IX49160 = ( $IX25338 - 1 ) * $IX75088; $IX34623 = $wpdb->prepare( "SELECT SQL_CALC_FOUND_ROWS $IX31703.*, $wpdb->users.* " . "FROM $IX31703 " . "LEFT JOIN $IX17212 ON $IX31703.affiliate_id = $IX17212.affiliate_id " . "LEFT JOIN $wpdb->users on $IX17212.user_id = $wpdb->users.ID " . "$IX78748 " . "ORDER BY $IX68672 $IX82325 " . "LIMIT $IX75088 OFFSET $IX49160", $IX24517 ); $IX98124 = $wpdb->get_results( $IX34623, OBJECT ); $IX41233 = intval( $wpdb->get_var( "SELECT FOUND_ROWS()" ) ); if ( $IX41233 > $IX75088 ) { $IX84732 = true; } else { $IX84732 = false; } $IX79627 = max( array( 1, ceil( $IX41233 / $IX75088 ) ) ); if ( $IX25338 > $IX79627 ) { $IX25338 = $IX79627; $IX21608 = true; } } while ( $IX21608 ); $IX81285 = array( 'affiliate_id' => __( 'Id', 'affiliates' ), 'name' => __('附屬機構', 'affiliates' ), 'email' => __('電子郵件', 'affiliates' ), 'user_login' => __('用戶名', 'affiliates' ), 'from_date' => __('從', 'affiliates' ), 'thru_date' => __('直到', 'affiliates' ), 'status' => __('地位', 'affiliates' ), 'links' => __('鏈接', 'affiliates' ), ); foreach ( Affiliates_Attributes::get_keys() as $IX50097 => $IX58670 ) { $IX38010 = $IX50097; $IX50097 = '_attr_' . preg_replace( '/(\.|\-)/', '_', $IX50097 ); $IX81285[$IX50097] = $IX58670; } require_once AFFILIATES_CORE_LIB . '/class-affiliates-settings.php'; require_once AFFILIATES_CORE_LIB . '/class-affiliates-settings-registration.php'; $IX75327 = Affiliates_Settings_Registration::get_fields(); foreach( Affiliates_Registration::get_skip_meta_fields() as $IX55611 ) { unset( $IX75327[$IX55611] ); } if ( !empty( $IX75327 ) ) { foreach( $IX75327 as $IX22314 => $IX58771 ) { if ( $IX58771['enabled'] ) { $IX81285[$IX22314] = stripslashes( $IX58771['label'] ); } } } $IX63959 = array(); foreach( array_keys( $IX81285 ) as $IX55611 ) { $IX55611 = preg_replace( '/(\.|\-)/', '_', $IX55611 ); switch( $IX55611 ) { case 'name' : case 'email' : case 'user_login' : $IX63959[$IX55611] = true; break; default : $IX63959[$IX55611] = false; } } $IX82530 = $IX63959; foreach( $affiliates_options->get_option( 'affiliates_overview_columns', array() ) as $IX55611 => $IX70774 ) { $IX82530[$IX55611] = $IX70774; } $IX78362 = 0; $IX14171 .= '<script type="text/javascript">'; $IX14171 .= 'affiliates_overview_columns={'; $IX65503 = array(); foreach( $IX82530 as $IX55611 => $IX70774 ) { $IX65503[] = wp_strip_all_tags( $IX55611 ).':' . ( $IX70774 ? 'true' : 'false' ); if ( $IX70774 ) { $IX78362++; } } $IX78362++; $IX14171 .= implode( ',', $IX65503 ); $IX14171 .= '};'; $IX14171 .= '</script>'; $IX14171 .= '<div class="affiliates-overview">'; $IX14171 .= sprintf( '<div id="filters-container" class="filters" style="%s">', $IX51491 ? '' : 'display:none' ); $IX14171 .= '<label class="description" for="setfilters">' . __('過濾器', 'affiliates' ) . '</label>'; $IX14171 .= '<div>'; $IX14171 .= '<form id="setfilters" action="" method="post">'; $IX14171 .= '<div class="filter-section">' . '<label class="affiliate-id-filter shrink">' . __( 'Id', 'affiliates' ) . ' ' . '<input class="affiliate-id-filter" name="affiliate_id" type="text" value="' . esc_attr( $IX43379 ) . '"/>' . '</label>' . ' ' . '<label class="affiliate-name-filter">' . __('姓名', 'affiliates' ) . ' ' . '<input class="affiliate-name-filter" name="affiliate_name" type="text" value="' . $IX77117 . '"/>' . '</label>' . ' ' . '<label class="affiliate-email-filter">' . __('電子郵件', 'affiliates' ) . ' ' . '<input class="affiliate-email-filter" name="affiliate_email" type="text" value="' . $IX96089 . '"/>' . '</label>' . ' ' . '<label class="affiliate-user-login-filter">' . __('用戶名', 'affiliates' ) . ' ' . '<input class="affiliate-user-login-filter" name="affiliate_user_login" type="text" value="' . $IX20815 . '" />' . '</label>' . '</div>' . '<div class="filter-section">' . '<label class="from-date-filter">' . __('從', 'affiliates' ) . ' ' . '<input class="datefield from-date-filter" name="from_date" type="text" value="' . esc_attr( $IX51697 ) . '"/>'. '</label>' . ' ' . '<label class="thru-date-filter">' . __('直到', 'affiliates' ) . ' ' . '<input class="datefield thru-date-filter" name="thru_date" type="text" class="datefield" value="' . esc_attr( $IX44287 ) . '"/>'. '</label>' . '</div>' . '<div class="filter-section">' . '<label class="show-inoperative-filter">' . '<input class="show-inoperative-filter" name="show_inoperative" type="checkbox" ' . ( $IX17928 ? 'checked="checked"' : '' ) . '/>' . ' ' . __('包括不運作的附屬公司', 'affiliates' ) . '</label>' . ' ' . '<label class="show-active-filter">' . '<input class="show-active-filter" name="show_active" type="checkbox" ' . ( $IX60065 ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include active affiliates', AFFILIATES_PLUGIN_DOMAIN ) . '</label>' . ' ' . '<label class="show-pending-filter">' . '<input class="show-pending-filter" name="show_pending" type="checkbox" ' . ( $IX20318 ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include pending affiliates', AFFILIATES_PLUGIN_DOMAIN ) . '</label>' . ' ' . '<label class="show-deleted-filter">' . '<input class="show-deleted-filter" name="show_deleted" type="checkbox" ' . ( $IX82673 ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Include removed affiliates', 'affiliates' ) . '</label>' . ' ' . '<label class="show-totals-filter">' . '<input class="show-totals-filter" name="show_totals" type="checkbox" ' . ( $IX46674 ? 'checked="checked"' : '' ) . '/>' . ' ' . __( 'Show accumulated referral totals', 'affiliates' ) . '</label>' . '</div>'; $IX14171 .= '<div class="filter-buttons">' . wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_FILTER_NONCE, true, false ) . '<input class="button" type="submit" value="' . __('申請', 'affiliates' ) . '"/>' . '<input class="button" type="submit" name="clear_filters" value="' . __('清除', 'affiliates' ) . '"/>' . '<input type="hidden" value="submitted" name="submitted"/>' . '</div>'; $IX14171 .= '</form>'; $IX14171 .= '</div>'; $IX14171 .= '</div>'; $IX14171 .= sprintf( '<div id="columns-container" class="filters" style="%s">', $IX77293 ? '' : 'display:none' ); $IX14171 .= '<div>'; $IX14171 .= __( 'Columns', 'affiliates' ); $IX14171 .= '</div>'; $IX14171 .= '<div id="column-toggles" class="column-toggles">'; foreach( $IX81285 as $IX55611 => $IX72495 ) { $IX25334 = preg_replace( '/(\.|\-)/', '_', $IX55611 ); $IX14171 .= '<div class="column-toggle-container">'; $IX14171 .= '<label>'; $IX14171 .= sprintf( '<input class="column-toggle" type="checkbox" name="column-toggle-%s" id="column-toggle-%s" value="%s" %s />', esc_attr( $IX25334 ), esc_attr( $IX25334 ), esc_attr( $IX25334 ), isset( $IX82530[$IX25334] ) && $IX82530[$IX25334] ? ' checked="checked" ' : '' ); $IX14171 .= $IX72495; $IX14171 .= '</label>'; $IX14171 .= '</div>'; } $IX14171 .= '</div>'; $IX14171 .= '</div>'; $IX14171 .= '
			<div class="page-options right">
				<form id="setrowcount" action="" method="post">
					<div>
						<label for="row_count">' . __('每頁結果', 'affiliates' ) . '</label>' . '<input name="row_count" type="text" size="2" value="' . esc_attr( $IX75088 ) .'" />
						' . wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_NONCE_1, true, false ) . '
						<input class="button" type="submit" value="' . __('申請', 'affiliates' ) . '"/>
					</div>
				</form>
			</div>
			'; if ( $IX84732 ) { $IX34274 = new Affiliates_Pagination($IX41233, null, $IX75088); $IX14171 .= '<form id="posts-filter" method="post" action="">'; $IX14171 .= '<div>'; $IX14171 .= wp_nonce_field( plugin_basename( __FILE__ ), AFFILIATES_ADMIN_AFFILIATES_NONCE_2, true, false ); $IX14171 .= '</div>'; $IX14171 .= '<div class="tablenav top">'; $IX14171 .= $IX34274->pagination( 'top' ); $IX14171 .= '</div>'; $IX14171 .= '</form>'; } $IX14171 .= '<form id="affiliates-action" method="post" action="">'; $IX14171 .= wp_nonce_field( 'admin', AFFILIATES_ADMIN_AFFILIATES_ACTION_NONCE, true, false ); $IX14171 .= '<div class="affiliates-bulk-container">'; $IX14171 .= '<select class="bulk-action" name="bulk-action">'; $IX14171 .= '<option selected="selected" value="-1">' . esc_html( __('批量操作', 'affiliates' ) ) . '</option>'; $IX14171 .= '<option value="remove-affiliate">' . esc_html( __('刪除附屬機構', 'affiliates' ) ) . '</option>'; $IX14171 .= '<option value="status-pending">' . esc_html( __('將狀態設置為待處理', 'affiliates' ) ) . '</option>'; $IX14171 .= '<option value="status-active">' . esc_html( __('將狀態設置為活動', 'affiliates' ) ) . '</option>'; $IX14171 .= '</select>'; $IX14171 .= sprintf( '<input class="button" type="submit" name="bulk" value="%s" />', esc_attr( __('申請', 'affiliates' ) ) ); $IX14171 .= '<input type="hidden" name="action" value="affiliate-action"/>'; $IX14171 .= '</div>'; $IX14171 .= '<table id="affiliates-overview-table" class="wp-list-table widefat fixed" cellspacing="0">'; $IX14171 .= '<thead>'; $IX14171 .= '<tr>'; $IX14171 .= '<th id="cb" class="manage-column column-cb check-column" scope="col"><input type="checkbox"></th>'; foreach ( $IX81285 as $IX55611 => $IX39919 ) { $IX55611 = preg_replace( '/(\.|\-)/', '_', $IX55611 ); $IX51393 = array( 'orderby' => $IX55611, 'order' => $IX78998 ); $IX83667 = $IX55611; if ( in_array( $IX55611, array( 'affiliate_id', 'name', 'email', 'user_login', 'from_date', 'thru_date', 'status' ) ) ) { if ( strcmp( $IX55611, $IX68672 ) == 0 ) { $IX88696 = strtolower( $IX82325 ); $IX83667 = "$IX55611 manage-column sorted $IX88696"; } else { $IX83667 = "$IX55611 manage-column sortable"; } $IX39919 = '<a href="' . esc_url( add_query_arg( $IX51393, $IX67176 ) ) . '"><span>' . $IX39919 . '</span><span class="sorting-indicator"></span></a>'; } $IX14171 .= sprintf( '<th scope="col" class="%s" style="%s">%s</th>', esc_attr( $IX83667 ), isset( $IX82530[$IX55611] ) && $IX82530[$IX55611] ? '' : 'display:none', $IX39919 ); } $IX14171 .= '</tr>'; $IX14171 .= '</thead>'; $IX14171 .= '<tbody>'; if ( count( $IX98124 ) > 0 ) { for ( $IX64764 = 0; $IX64764 < count( $IX98124 ); $IX64764++ ) { $IX24605 = $IX98124[$IX64764]; $IX10509 = ''; $IX97624 = ''; if ( $IX27712 = ( strcmp( $IX24605->status, 'deleted' ) == 0 ) ) { $IX97624 = ' deleted '; $IX10509 .= " " . __('已刪除', 'affiliates' ); } else if ( strcmp( $IX24605->status, 'pending' ) == 0 ) { $IX97624 .= ' pending '; } $IX63087 = ''; if ( $IX65593 = ! ( ( $IX24605->from_date <= $IX58443 ) && ( $IX24605->thru_date == null || $IX24605->thru_date >= $IX58443 ) ) ) { $IX63087 = ' inoperative '; $IX10509 .= " " . __('無效', 'affiliates' ); } $IX14171 .= '<tr class="' . $IX97624 . $IX63087 . ( $IX64764 % 2 == 0 ? 'even' : 'odd' ) . '">'; $IX14171 .= '<th class="check-column">'; $IX14171 .= '<input type="checkbox" value="' . esc_attr( $IX24605->affiliate_id ) . '" name="affiliate_ids[]"/>'; $IX14171 .= '</th>'; $IX14171 .= sprintf( '<td class="affiliate_id" style="%s">', isset( $IX82530['affiliate_id'] ) && $IX82530['affiliate_id'] ? '' : 'display:none' ); if ( affiliates_encode_affiliate_id( $IX24605->affiliate_id ) != $IX24605->affiliate_id ) { $IX14171 .= '<span class="encoded-hint" title="' . affiliates_encode_affiliate_id( $IX24605->affiliate_id ) . '">' . $IX24605->affiliate_id . '</span>'; } else { $IX14171 .= $IX24605->affiliate_id; } $IX14171 .= '</td>'; $IX33487 = remove_query_arg( array( 'paged', 'action', 'affiliate_id' ), $IX67176 ); $IX33487 = add_query_arg( array( 'paged' => $IX25338, 'action' => 'edit', 'affiliate_id' => $IX24605->affiliate_id ), $IX67176 ); $IX14171 .= sprintf( '<td class="name affiliate-name" style="%s">', isset( $IX82530['name'] ) && $IX82530['name'] ? '' : 'display:none' ); $IX14171 .= '<div>'; $IX14171 .= sprintf( '<a href="%s">%s</a>', esc_url( $IX33487 ), stripslashes( wp_filter_nohtml_kses( $IX24605->name ) ) . $IX10509 ); $IX14171 .= '</div>'; $IX14171 .= '<div>'; $IX14171 .= sprintf( '<a class="edit" href="%s">%s</a>', esc_url( $IX33487 ), __('編輯', 'affiliates' ), __('編輯', 'affiliates' ) ); if ( !$IX27712 && ( !isset( $IX24605->type ) || ( $IX24605->type != AFFILIATES_DIRECT_TYPE ) ) ) { $IX57323 = remove_query_arg( array( 'paged', 'action', 'affiliate_id' ), $IX67176 ); $IX57323 = add_query_arg( array( 'paged' => $IX25338, 'action' => 'remove', 'affiliate_id' => $IX24605->affiliate_id ), $IX67176 ); $IX14171 .= ' '; $IX14171 .= sprintf( '<a class="remove" href="%s">%s</a>', esc_url( $IX57323 ), __('消除', 'affiliates' ), __('消除', 'affiliates' ) ); } $IX14171 .= '</div>'; $IX14171 .= '</td>'; $IX14171 .= sprintf( '<td class="email affiliate-email" style="%s">', isset( $IX82530['email'] ) && $IX82530['email'] ? '' : 'display:none' ); $IX14171 .= $IX24605->email; if ( isset( $IX24605->email ) && isset( $IX24605->user_email ) && strcmp( $IX24605->email, $IX24605->user_email ) !== 0 ) { $IX14171 .= '<span title="' . sprintf( __( '聯營公司和關聯用戶記錄有不同的電子郵件地址。 這可能沒問題，但如果有疑問，請檢查。 用戶存檔的電子郵件地址是 %s', 'affiliates' ), $IX24605->user_email ) . '" class="warning"> [&nbsp;!&nbsp]</span>'; } $IX14171 .= '</td>'; $IX14171 .= sprintf( '<td class="user_login affiliate-user-login" style="%s">', isset( $IX82530['user_login'] ) && $IX82530['user_login'] ? '' : 'display:none' ); if ( !empty( $IX24605->ID ) ) { if ( current_user_can( 'edit_user', $IX24605->ID ) ) { $IX14171 .= '<a target="_blank" href="' . esc_url( "user-edit.php?user_id=$IX24605->ID" ) . '">' . $IX24605->user_login . '</a>'; } else { $IX14171 .= $IX24605->user_login; } } $IX14171 .= '</td>'; $IX14171 .= sprintf( '<td class="from_date from-date" style="%s">', isset( $IX82530['from_date'] ) && $IX82530['from_date'] ? '' : 'display:none' ); $IX14171 .= $IX24605->from_date; $IX14171 .= '</td>'; $IX14171 .= sprintf( '<td class="thru_date thru-date" style="%s">', isset( $IX82530['thru_date'] ) && $IX82530['thru_date'] ? '' : 'display:none' ); $IX14171 .= $IX24605->thru_date; $IX14171 .= '</td>'; $IX14171 .= sprintf( '<td class="status" style="%s">', isset( $IX82530['status'] ) && $IX82530['status'] ? '' : 'display:none' ); $IX14171 .= $IX24605->status; $IX14171 .= '</td>'; $IX14171 .= sprintf( '<td class="links" style="%s">', isset( $IX82530['links'] ) && $IX82530['links'] ? '' : 'display:none' ); $IX44856 = affiliates_encode_affiliate_id( $IX24605->affiliate_id ); $IX14171 .= __('關聯', 'affiliates' ) . ': ' . '<span class="affiliate-link">' . Affiliates_Url_Renderer::get_affiliate_url( home_url(), $IX24605->affiliate_id ) . '</span>' . '<br/>' . __('網址參數', 'affiliates' ) . ': ' . '<span class="affiliate-link-param">' . '?' . $IX73859 . '=' . $IX44856 . '</span>'; $IX14171 .= '</td>'; foreach ( Affiliates_Attributes::get_keys() as $IX50097 => $IX58670 ) { $IX38010 = $IX50097; $IX50097 = '_attr_' . preg_replace( '/(\.|\-)/', '_', $IX50097 ); $IX22209 = isset( $IX82530[$IX50097] ) && $IX82530[$IX50097] ? '' : 'display:none'; $IX53063 = $affiliates_db->get_value( "SELECT attr_value FROM $IX31307 WHERE affiliate_id = %d AND attr_key = %s", $IX24605->affiliate_id, $IX38010 ); $IX14171 .= sprintf( '<td class="%s" style="%s">', $IX50097, $IX22209 ); $IX14171 .= wp_filter_nohtml_kses( !empty( $IX53063 ) ? $IX53063 : '' ); $IX14171 .= '</td>'; } foreach( $IX75327 as $IX22314 => $IX58771 ) { if ( $IX58771['enabled'] ) { $IX26728 = isset( $IX58771['type'] ) ? $IX58771['type'] : 'text'; $IX70774 = ''; switch( $IX22314 ) { case 'user_login' : $IX70774 = $IX20066->user_login; break; case 'user_email' : $IX70774 = $IX20066->user_email; break; case 'user_url' : $IX70774 = $IX20066->user_url; break; case 'password' : $IX70774 = ''; break; default : $IX70774 = get_user_meta( $IX24605->ID, $IX22314 , true ); } $IX22209 = isset( $IX82530[$IX22314] ) && $IX82530[$IX22314] ? '' : 'display:none'; $IX14171 .= sprintf( '<td class="%s" style="%s">', $IX22314, $IX22209 ); $IX14171 .= stripslashes( wp_filter_nohtml_kses( $IX70774 ) ); $IX14171 .= '</td>'; } } $IX14171 .= '</tr>'; if ( $IX46674 ) { $IX14171 .= '<tr class="' . $IX97624 . $IX63087 . ( $IX64764 % 2 == 0 ? 'even' : 'odd' ) . '">'; $IX26324 = array(); $IX26324[AFFILIATES_REFERRAL_STATUS_CLOSED] = Affiliates_Shortcodes::get_total( $IX24605->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_CLOSED ); $IX26324[AFFILIATES_REFERRAL_STATUS_ACCEPTED] = Affiliates_Shortcodes::get_total( $IX24605->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_ACCEPTED ); $IX26324[AFFILIATES_REFERRAL_STATUS_PENDING] = Affiliates_Shortcodes::get_total( $IX24605->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_PENDING ); $IX26324[AFFILIATES_REFERRAL_STATUS_REJECTED] = Affiliates_Shortcodes::get_total( $IX24605->affiliate_id, null, null, AFFILIATES_REFERRAL_STATUS_REJECTED ); $IX14171 .= '<td class="dynamic-colspan" colspan="' . $IX78362 . '">'; $IX14171 .= '<table class="affiliate-referral-totals">'; $IX14171 .= '<thead>'; $IX14171 .= '<tr>'; foreach( $IX26324 as $IX91925 => $IX63724 ) { if ( $IX63724 ) { $IX14171 .= '<th>'; $IX14171 .= '<strong>'; switch( $IX91925 ) { case AFFILIATES_REFERRAL_STATUS_CLOSED : $IX14171 .= sprintf( __('<span style="cursor:help" title="%s">已關閉</span>', 'affiliates' ), esc_attr( __('已關閉推薦的累計總額（已支付的佣金）。', 'affiliates' ) ) ); break; case AFFILIATES_REFERRAL_STATUS_ACCEPTED : $IX14171 .= sprintf( __('<span style="cursor:help" title="%s">已接受</span>', 'affiliates' ), esc_attr( __('接受推薦的累計總數（未支付佣金）。', 'affiliates' ) ) ); break; case AFFILIATES_REFERRAL_STATUS_PENDING : $IX14171 .= sprintf( __('<span style="cursor:help" title="%s">待處理</span>', 'affiliates' ), esc_attr( __( 'Accumulated total for pending referrals.', 'affiliates' ) ) ); break; case AFFILIATES_REFERRAL_STATUS_REJECTED : $IX14171 .= sprintf( __( '<span style="cursor:help" title="%s">Rejected</span>', 'affiliates' ), esc_attr( __( 'Accumulated total for rejected referrals.', 'affiliates' ) ) ); break; } $IX14171 .= '</strong>'; $IX14171 .= '</th>'; } } $IX14171 .= '</thead>'; $IX14171 .= '</tr>'; $IX14171 .= '<tbody>'; $IX14171 .= '<tr>'; foreach( $IX26324 as $IX91925 => $IX63724 ) { if ( $IX63724 ) { $IX14171 .= '<td>'; $IX14171 .= '<ul>'; foreach( $IX63724 as $IX39228 => $IX38999 ) { $IX14171 .= '<li>'; $IX14171 .= sprintf( __( '%1$s %2$s', 'affiliates' ), $IX39228, $IX38999 ); $IX14171 .= '</li>'; } $IX14171 .= '</ul>'; $IX14171 .= '</td>'; } } $IX14171 .= '</tr>'; $IX14171 .= '<tbody>'; $IX14171 .= '</table>'; $IX14171 .= '</td>'; $IX14171 .= '</tr>'; } } } else { $IX14171 .= '<tr><td class="dynamic-colspan" colspan="' . $IX78362 . '">' . __('沒有結果。', 'affiliates' ) . '</td></tr>'; } $IX14171 .= '</tbody>'; $IX14171 .= '</table>'; if ( $IX84732 ) { $IX34274 = new Affiliates_Pagination( $IX41233, null, $IX75088 ); $IX14171 .= '<div class="tablenav bottom">'; $IX14171 .= $IX34274->pagination( 'bottom' ); $IX14171 .= '</div>'; } $IX14171 .= '</div>'; $IX14171 .= '</div>'; echo $IX14171;  }
}
