<?php
/**
 * class-affiliates-totals.php
 *
 * Copyright 2011 "kento" Karim Rahimpur - www.itthinx.com
 *
 * This code is provided subject to the license granted.
 * Unauthorized use and distribution is prohibited.
 * See COPYRIGHT.txt and LICENSE.txt
 *
 * This code is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 *
 * This header and all notices must be kept intact.
 *
 * @author Karim Rahimpur
 * @package affiliates-pro
 * @since affiliates-pro 1.0.0
 */

/**
 * Implementation-independent abstract totals class, provides system-independent structure and process.
 */
abstract class Affiliates_Totals implements I_Affiliates_Totals {

	public static function get_mass_payment_file( $service = 'paypal', $params = null, $charset = null ) { global $affiliates_db; $IX27618 = isset( $params['from_date'] ) ? $params['from_date'] : null; $IX52886 = $IX27618 ? DateHelper::u2s( $IX27618 ) : null; $IX29842 = isset( $params['thru_date'] ) ? $params['thru_date'] : null; $IX98034 = $IX29842 ? DateHelper::u2s( $IX29842, 24*3600 ) : null; $IX64416 = isset( $params['minimum_total'] ) ? Affiliates_Math::add( "0", $params['minimum_total'], affiliates_get_referral_amount_decimals() ) : null; $IX54607 = isset( $params['affiliate_status'] ) ? Affiliates_Utility::verify_affiliate_status( $params['affiliate_status'] ) : null; $IX25270 = isset( $params['referral_status'] ) ? Affiliates_Utility::verify_referral_status_transition( $params['referral_status'], $params['referral_status'] ) : null; $IX48705 = isset( $params['currency_id'] ) ? Affiliates_Utility::verify_currency_id( $params['currency_id'] ) : null; $IX82181 = isset( $params['affiliate_id'] ) ? affiliates_check_affiliate_id( $params['affiliate_id'] ) : null; $IX79344 = isset( $params['affiliate_name'] ) ? $params['affiliate_name'] : null; $IX96297 = isset( $params['affiliate_user_login'] ) ? $params['affiliate_user_login'] : null; $IX68291 = isset( $params['orderby'] ) ? $params['orderby'] : null; $IX80808 = isset( $params['order'] ) ? $params['order'] : null; switch ( $IX68291 ) { case 'affiliate_id' : case 'name' : case 'user_login' : case 'email' : case 'total' : case 'currency_id' : break; default: $IX68291 = 'name'; } switch ( $IX80808 ) { case 'asc' : case 'ASC' : case 'desc' : case 'DESC' : break; default: $IX80808 = 'ASC'; } if ( isset( $params['tables'] ) ) { $IX20126 = $params['tables']['affiliates']; $IX68955 = $params['tables']['affiliates_users']; $IX49169 = $params['tables']['referrals']; $IX43679 = $params['tables']['users']; $IX81605 = array( " 1=%d " ); $IX88536 = array( 1 ); if ( $IX82181 ) { $IX81605[] = " a.affiliate_id = %d "; $IX88536[] = $IX82181; } if ( $IX79344 ) { $IX81605[] = " a.name LIKE %s "; $IX88536[] = '%' . $affiliates_db->esc_like( $IX79344 ) . '%'; } if ( $IX96297 ) { $IX81605[] = " u.user_login LIKE %s "; $IX88536[] = '%' . $affiliates_db->esc_like( $IX96297 ) . '%'; } if ( $IX52886 && $IX98034 ) { $IX81605[] = " r.datetime >= %s AND r.datetime < %s "; $IX88536[] = $IX52886; $IX88536[] = $IX98034; } else if ( $IX52886 ) { $IX81605[] = " r.datetime >= %s "; $IX88536[] = $IX52886; } else if ( $IX98034 ) { $IX81605[] = " r.datetime < %s "; $IX88536[] = $IX98034; } if ( $IX54607 ) { $IX81605[] = " a.status = %s "; $IX88536[] = $IX54607; } if ( $IX25270 ) { $IX81605[] = " r.status = %s "; $IX88536[] = $IX25270; } if ( $IX48705 ) { $IX81605[] = " r.currency_id = %s "; $IX88536[] = $IX48705; } if ( !empty( $IX81605 ) ) { $IX81605 = " WHERE " . implode( " AND ", $IX81605 ); } else { $IX81605 = ''; } $IX49424 = ''; if ( $IX64416 ) { $IX49424 .= " HAVING SUM(r.amount) >= %s "; $IX88536[] = $IX64416; } $IX62898 = ''; if ( $IX68291 && $IX80808 ) { $IX62898 .= " ORDER BY $IX68291 $IX80808 "; } $IX43775 = $affiliates_db->get_objects( "
				SELECT a.*, u.user_login, SUM(r.amount) as total, r.currency_id
				FROM $IX49169 r
				LEFT JOIN $IX20126 a ON r.affiliate_id = a.affiliate_id
				LEFT JOIN $IX68955 au ON a.affiliate_id = au.affiliate_id
				LEFT JOIN $IX43679 u on au.user_id = u.ID
				$IX81605
				GROUP BY r.affiliate_id, r.currency_id
				$IX49424
				$IX62898
				", $IX88536 ); $service = strtolower( $service ); if ( !headers_sent() ) { switch ( $service ) { case 'paypal' : $IX63511 = date( 'Y-m-d-H-i-s', time() ); $IX58342 = false; $IX73712 = false; require_once AFFILIATES_CORE_LIB . '/class-affiliates-settings.php'; require_once AFFILIATES_CORE_LIB . '/class-affiliates-settings-registration.php'; $IX98326 = Affiliates_Settings_Registration::get_fields(); foreach ( $IX98326 as $IX41859 => $IX39072 ) { if ( $IX39072['enabled'] ) { switch ( $IX41859 ) { case 'paypal_email' : $IX58342 = true; break; case 'payment_email' : $IX73712 = true; break; } } } header( 'Content-Description: File Transfer' ); if ( !empty( $charset ) ) { header( 'Content-Type: text/plain; charset=' . $charset ); } else { header( 'Content-Type: text/plain' ); } header( "Content-Disposition: attachment; filename=\"affiliates-mass-payment-$IX63511.txt\"" ); foreach( $IX43775 as $IX89207 ) { $IX43591 = $IX89207->email; $IX96224 = Affiliates_Affiliate::get_attribute( $IX89207->affiliate_id, Affiliates_Attributes::PAYPAL_EMAIL ); if ( !empty( $IX96224 ) ) { $IX43591 = $IX96224; } $IX84364 = null; if ( $IX73712 || $IX58342 ) { if ( !empty( $IX89207->user_login ) ) { if ( $IX82868 = get_user_by( 'login', $IX89207->user_login ) ) { $IX84364 = $IX82868->ID; $IX41509 = new Affiliates_Validator(); if ( $IX58342 ) { $IX66963 = get_user_meta( $IX82868->ID, 'paypal_email', true ); if ( is_string( $IX66963 ) ) { $IX66963 = trim( $IX66963 ); $IX66963 = $IX41509->validate_email( $IX66963 ); } if ( !empty( $IX66963 ) ) { $IX43591 = $IX66963; } } if ( $IX73712 ) { $IX66963 = get_user_meta( $IX82868->ID, 'payment_email', true ); if ( is_string( $IX66963 ) ) { $IX66963 = trim( $IX66963 ); $IX66963 = $IX41509->validate_email( $IX66963 ); } if ( !empty( $IX66963 ) ) { $IX43591 = $IX66963; } } } } } $IX68614 = $IX43591; $IX50505 = affiliates_format_referral_amount( $IX89207->total, 'display' ); $IX48705 = $IX89207->currency_id; $IX82181 = $IX89207->affiliate_id; $IX74955 = 'Affiliate payment'; $IX43007 = apply_filters( 'affiliates_totals_payment_file_line', array( 'email' => $IX68614, 'amount' => $IX50505, 'currency_id' => $IX48705, 'affiliate_id' => $IX82181, 'note' => $IX74955 ), $IX82181, $IX84364, $IX89207 ); $IX68614 = $IX43007['email']; $IX50505 = $IX43007['amount']; $IX48705 = $IX43007['currency_id']; $IX82181 = $IX43007['affiliate_id']; $IX74955 = $IX43007['note']; if ( !empty( $IX68614 ) && !empty( $IX50505 ) && !empty( $IX48705 ) ) { echo apply_filters( 'affiliates_totals_payment_file_line_output', "$IX68614\t$IX50505\t$IX48705\t$IX82181\t$IX74955\n", $IX43007, $IX82181, $IX84364, $IX89207 ); } } break; case 'export' : $IX63511 = date( 'Y-m-d-H-i-s', time() ); header( 'Content-Description: File Transfer' ); if ( !empty( $charset ) ) { header( 'Content-Type: text/tab-separated-values; charset=' . $charset ); } else { header( 'Content-Type: text/tab-separated-values' ); } header( "Content-Disposition: attachment; filename=\"affiliates-totals-export-$IX63511.tsv\"" ); $IX47643 = array( __( 'Id', 'affiliates' ), __('附屬機構', 'affiliates' ), __('電子郵件', 'affiliates' ), __('用戶名', 'affiliates' ), __('全部的', 'affiliates' ), __('貨幣', 'affiliates' ) ); $IX47643 = apply_filters( 'affiliates_totals_export_file_headings', $IX47643 ); for ( $IX58459 = 0; $IX58459 < count( $IX47643 ); $IX58459++ ) { echo $IX47643[$IX58459]; echo "\t"; } echo "\n"; foreach( $IX43775 as $IX89207 ) { $IX82181 = $IX89207->affiliate_id; $IX41859 = stripslashes( !empty( $IX89207->name ) ? $IX89207->name : '' ); $IX68614 = $IX89207->email; $IX83062 = stripslashes( !empty( $IX89207->user_login ) ? $IX89207->user_login : '' ); $IX50505 = affiliates_format_referral_amount( $IX89207->total, 'display' ); $IX48705 = $IX89207->currency_id; $IX84364 = null; if ( $IX82868 = get_user_by( 'login', !empty( $IX89207->user_login ) ? $IX89207->user_login : '' ) ) { $IX84364 = $IX82868->ID; } $IX43007 = apply_filters( 'affiliates_totals_export_file_line', array( 'affiliate_id' => $IX82181, 'name' => $IX41859, 'email' => $IX68614, 'user_login' => $IX83062, 'amount' => $IX50505, 'currency_id' => $IX48705, 'suffix' => '' ), $IX82181, $IX84364, $IX89207 ); $IX82181 = $IX43007['affiliate_id']; $IX41859 = $IX43007['name']; $IX68614 = $IX43007['email']; $IX83062 = $IX43007['user_login']; $IX50505 = $IX43007['amount']; $IX48705 = $IX43007['currency_id']; $IX16574 = $IX43007['suffix']; if ( strlen( $IX16574 ) > 0 ) { $IX16574 = "\t$IX16574"; } echo apply_filters( 'affiliates_totals_export_file_line_output', "$IX82181\t$IX41859\t$IX68614\t$IX83062\t$IX50505\t$IX48705$IX16574\n", $IX43007, $IX82181, $IX84364, $IX89207 ); } } } else { wp_die( 'ERROR: headers already sent' ); } } }

	public static function update_status( $new_status, $params = null ) { global $affiliates_db; $IX77619 = ""; $IX55769 = isset( $params['from_date'] ) ? $params['from_date'] : null; $IX62864 = $IX55769 ? DateHelper::u2s( $IX55769 ) : null; $IX43575 = isset( $params['thru_date'] ) ? $params['thru_date'] : null; $IX28910 = $IX43575 ? DateHelper::u2s( $IX43575, 24*3600 ) : null; $IX29623 = isset( $params['minimum_total'] ) ? Affiliates_Math::add( "0", $params['minimum_total'], affiliates_get_referral_amount_decimals() ) : null; $IX31162 = isset( $params['affiliate_status'] ) ? Affiliates_Utility::verify_affiliate_status( $params['affiliate_status'] ) : null; $IX60368 = isset( $params['referral_status'] ) ? Affiliates_Utility::verify_referral_status_transition( $params['referral_status'], $params['referral_status'] ) : null; $IX14753 = isset( $params['currency_id'] ) ? Affiliates_Utility::verify_currency_id( $params['currency_id'] ) : null; $IX76033 = isset( $params['affiliate_id'] ) ? affiliates_check_affiliate_id( $params['affiliate_id'] ) : null; $IX55958 = isset( $params['affiliate_name'] ) ? $params['affiliate_name'] : null; $IX29158 = isset( $params['affiliate_user_login'] ) ? $params['affiliate_user_login'] : null; $IX73246 = isset( $params['orderby'] ) ? $params['orderby'] : null; $IX66061 = isset( $params['order'] ) ? $params['order'] : null; switch ( $IX73246 ) { case 'affiliate_id' : case 'name' : case 'email' : $IX73246 = 'a.' . $IX73246; break; case 'user_login' : $IX73246 = 'au.' . $IX73246; break; case 'currency_id' : $IX73246 = 'r.' . $IX73246; break; default: $IX73246 = 'a.name'; } switch ( $IX66061 ) { case 'asc' : case 'ASC' : case 'desc' : case 'DESC' : break; default: $IX66061 = 'ASC'; } if ( isset( $params['tables'] ) ) { $IX77619 .= "<h1>" . __( "Closing referrals", 'affiliates' ) . "</h1>"; $IX77619 .= "<div class='closing-referrals-overview'>"; $IX70500 = $params['tables']['affiliates']; $IX82458 = $params['tables']['affiliates_users']; $IX75172 = $params['tables']['referrals']; $IX88623 = $params['tables']['users']; $IX41435 = array( " 1=%d " ); $IX43052 = array( 1 ); if ( $IX76033 ) { $IX41435[] = " a.affiliate_id = %d "; $IX43052[] = $IX76033; } if ( $IX55958 ) { $IX41435[] = " a.name LIKE %s "; $IX43052[] = '%' . $affiliates_db->esc_like( $IX55958 ) . '%'; } if ( $IX29158 ) { $IX41435[] = " u.user_login LIKE %s "; $IX43052[] = '%' . $affiliates_db->esc_like( $IX29158 ) . '%'; } if ( $IX62864 && $IX28910 ) { $IX41435[] = " r.datetime >= %s AND r.datetime < %s "; $IX43052[] = $IX62864; $IX43052[] = $IX28910; } else if ( $IX62864 ) { $IX41435[] = " r.datetime >= %s "; $IX43052[] = $IX62864; } else if ( $IX28910 ) { $IX41435[] = " r.datetime < %s "; $IX43052[] = $IX28910; } if ( $IX31162 ) { $IX41435[] = " a.status = %s "; $IX43052[] = $IX31162; } if ( $IX60368 ) { $IX41435[] = " r.status = %s "; $IX43052[] = $IX60368; } if ( $IX14753 ) { $IX41435[] = " r.currency_id = %s "; $IX43052[] = $IX14753; } if ( $IX29623 ) { $IX59688 = $IX41435; if ( !empty( $IX59688 ) ) { $IX59688 = " WHERE " . implode( " AND ", $IX41435 ); } else { $IX59688 = ''; } $IX62917 = $IX43052; $IX93150 = " HAVING SUM(r.amount) >= %s "; $IX62917[] = $IX29623; $IX41435[] = " (a.affiliate_id, r.currency_id) IN
					(
					SELECT r.affiliate_id, r.currency_id
					FROM $IX75172 r
					LEFT JOIN $IX70500 a ON r.affiliate_id = a.affiliate_id
					LEFT JOIN $IX82458 au ON a.affiliate_id = au.affiliate_id
					LEFT JOIN $IX88623 u on au.user_id = u.ID
					$IX59688
					GROUP BY r.affiliate_id, r.currency_id
					$IX93150
					)
					"; foreach( $IX62917 as $IX95878 ) { array_push( $IX43052, $IX95878 ); } $IX41435[] = " r.amount IS NOT NULL "; } if ( !empty( $IX41435 ) ) { $IX41435 = " WHERE " . implode( " AND ", $IX41435 ); } else { $IX41435 = ''; } $IX53938 = ''; if ( $IX73246 && $IX66061 ) { $IX53938 .= " ORDER BY $IX73246 $IX66061 "; } $IX35580 = isset( $params['step'] ) ? intval( $params['step'] ) : 1; switch ( $IX35580 ) { case 1 : $IX26397 = $affiliates_db->get_objects( "
						SELECT a.*, r.*, u.user_login
						FROM $IX75172 r
						LEFT JOIN $IX70500 a ON r.affiliate_id = a.affiliate_id
						LEFT JOIN $IX82458 au ON a.affiliate_id = au.affiliate_id
						LEFT JOIN $IX88623 u on au.user_id = u.ID
						$IX41435
						$IX53938
						", $IX43052 ); $IX77619 .= "<div class='manage'>"; $IX77619 .= "<div class='warning'>"; $IX77619 .= "<p>"; $IX77619 .= "<strong>"; $IX77619 .= __( "Please review the list of referrals that will be <em>closed</em>.", 'affiliates' ); $IX77619 .= "</strong>"; $IX77619 .= "</p>"; $IX77619 .= "</div>"; $IX77619 .= "<p>"; $IX77619 .= __( "Usually only referrals that are <em>accepted</em> and have been paid out should be <em>closed</em>. If there are unwanted or too many referrals shown, restrict your filter settings.", 'affiliates' ); $IX77619 .= "</p>"; $IX77619 .= "<p>"; $IX77619 .= __( "If these referrals can be closed, click the confirmation button below.", 'affiliates' ); $IX77619 .= "</p>"; $IX77619 .= "</div>"; $IX77619 .= '<div id="referrals-overview" class="referrals-overview">'; $IX77619 .= self::render_results( $IX26397 ); $IX77619 .= '</div>'; if ( count( $IX26397 ) > 0 ) { $IX71515 = ""; if ( !empty( $IX55769 ) ) { $IX71515 .= "&from_date=" . urlencode( $IX55769 ); } if ( !empty( $IX43575 ) ) { $IX71515 .= "&thru_date=" . urlencode( $IX43575 ); } if ( !empty( $IX29623 ) ) { $IX71515 .= "&minimum_total=" . urlencode( $IX29623 ); } if ( !empty( $IX31162 ) ) { $IX71515 .= "&affiliate_status=" . urlencode( $IX31162 ); } if ( !empty( $IX60368 ) ) { $IX71515 .= "&referral_status=" . urlencode( $IX60368 ); } if ( !empty( $IX14753 ) ) { $IX71515 .= "&currency_id=" . urlencode( $IX14753 ); } if ( !empty( $IX76033 ) ) { $IX71515 .= "&affiliate_id=" . urlencode( $IX76033 ); } if ( !empty( $IX55958 ) ) { $IX71515 .= "&affiliate_name=" . urlencode( $IX55958 ); } if ( !empty( $IX29158 ) ) { $IX71515 .= "&affiliate_user_login=" . urlencode( $IX29158 ); } if ( !empty( $IX73246 ) ) { $IX71515 .= "&orderby=" . urlencode( $IX73246 ); } if ( !empty( $IX66061 ) ) { $IX71515 .= "&order=" . urlencode( $IX66061 ); } $IX74627 = esc_url( AFFILIATES_PRO_PLUGIN_URL . 'lib/ext/includes/generate-mass-payment-file.php' ); $IX77619 .= '<div class="manage confirm">'; $IX44809 = ( is_ssl() ? 'https://' : 'http://' ) . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']; $IX44809 = remove_query_arg( 'paged', $IX44809 ); $IX44809 = remove_query_arg( 'action', $IX44809 ); $IX44809 = remove_query_arg( 'affiliate_id', $IX44809 ); $IX77619 .= "<p>"; $IX77619 .= __( "Close these referrals by clicking:", 'affiliates' ); $IX77619 .= "</p>"; $IX77619 .= "<a title='" . __( 'Click to close these referrals', 'affiliates' ) . "' " . "class='close-referrals button' " . "href='" . esc_url( $IX44809 ) . "&action=close_referrals&step=2" . $IX71515 . "'>" . "<img class='icon' alt='" . __( 'Close referrals', 'affiliates') . "' src='". AFFILIATES_PRO_PLUGIN_URL ."images/closed.png'/>" . "<span class='label'>" . __('密切推薦', 'affiliates') . "</span>" . "</a>"; $IX77619 .= "<div class='warning'>"; $IX77619 .= "<p>"; $IX77619 .= "<strong>"; $IX77619 .= __( "This action can not be undone*.", 'affiliates' ); $IX77619 .= "</strong>"; $IX77619 .= "</p>"; $IX77619 .= "<p>"; $IX77619 .= "<span style='font-size:0.8em;'>"; $IX77619 .= __( "*To undo, each referral would have to be set to the desired status individually.", 'affiliates' ); $IX77619 .= "</span>"; $IX77619 .= "</p>"; $IX77619 .= "</div>"; $IX77619 .= '</div>'; } break; case 2 : $IX26397 = $affiliates_db->get_objects( "
						SELECT a.*, r.*, u.user_login
						FROM $IX75172 r
						LEFT JOIN $IX70500 a ON r.affiliate_id = a.affiliate_id
						LEFT JOIN $IX82458 au ON a.affiliate_id = au.affiliate_id
						LEFT JOIN $IX88623 u on au.user_id = u.ID
						$IX41435
						$IX53938
						", $IX43052 ); $IX13625 = array(); $IX51622 = array(); $IX47917 = array(); foreach ( $IX26397 as $IX48428 ) { if ( $IX20980 = Affiliates_Utility::verify_referral_status_transition( $IX48428->status, $new_status ) ) { if ( $affiliates_db->query( "UPDATE $IX75172 SET status = %s WHERE affiliate_id = %d AND post_id = %d AND datetime = %s ", $IX20980, $IX48428->affiliate_id, $IX48428->post_id, $IX48428->datetime ) ) { $IX48428->status = $IX20980; $IX13625[] = $IX48428; } else { $IX47917[] = $IX48428; } } else { $IX51622[] = $IX48428; } } $IX51643 = array( AFFILIATES_REFERRAL_STATUS_ACCEPTED => __('已接受', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_CLOSED => __('關閉', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_PENDING => __('待辦的', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_REJECTED => __('拒絕', AFFILIATES_PLUGIN_DOMAIN ), ); $IX77619 .= "<h2>" . __( "Updated", 'affiliates' ) . "</h2>"; $IX77619 .= "<p>"; $IX77619 .= sprintf( __( "These referrals have been updated to <em>%s</em>.", 'affiliates' ), ( isset( $IX51643[$new_status] ) ? $IX51643[$new_status] : $new_status ) ); $IX77619 .= "</p>"; $IX77619 .= self::render_results( $IX13625 ); if ( count( $IX51622 ) > 0 ) { $IX77619 .= "<h2>" . __( "Omitted", 'affiliates' ) . "</h2>"; $IX77619 .= "<p>"; $IX77619 .= sprintf( __( "These referrals have been omitted because their status must not be changed to <em>%s</em>.", 'affiliates' ), ( isset( $IX51643[$new_status] ) ? $IX51643[$new_status] : $new_status ) ); $IX77619 .= "</p>"; $IX77619 .= self::render_results( $IX51622 ); } if ( count( $IX47917 ) > 0 ) { $IX77619 .= "<h2>" . __( "Failed", 'affiliates' ) . "</h2>"; $IX77619 .= "<p>"; $IX77619 .= sprintf( __( "These referrals could not be updated to <em>%s</em>.", 'affiliates' ), ( isset( $IX51643[$new_status] ) ? $IX51643[$new_status] : $new_status ) ); $IX77619 .= "</p>"; $IX77619 .= self::render_results( $IX47917 ); } break; } $IX77619 .= "</div>"; } return $IX77619; }

	public static function render_results( $results ) { $IX94019 = ""; $IX92845 = array( 'datetime' => __('日期', AFFILIATES_PLUGIN_DOMAIN ), 'post_title' => __('郵政', AFFILIATES_PLUGIN_DOMAIN ), 'name' => __('附屬機構', AFFILIATES_PLUGIN_DOMAIN ), 'amount' => __('數量', AFFILIATES_PLUGIN_DOMAIN ), 'currency_id' => __('貨幣', AFFILIATES_PLUGIN_DOMAIN ), 'status' => __('地位', AFFILIATES_PLUGIN_DOMAIN ) ); $IX41766 = array( AFFILIATES_REFERRAL_STATUS_ACCEPTED => __('已接受', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_CLOSED => __('關閉', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_PENDING => __('待辦的', AFFILIATES_PLUGIN_DOMAIN ), AFFILIATES_REFERRAL_STATUS_REJECTED => __('拒絕', AFFILIATES_PLUGIN_DOMAIN ), ); $IX37593 = array( AFFILIATES_REFERRAL_STATUS_ACCEPTED => "<img class='icon' alt='" . __('已接受', 'affiliates') . "' src='" . AFFILIATES_PRO_PLUGIN_URL . "images/accepted.png'/>", AFFILIATES_REFERRAL_STATUS_CLOSED => "<img class='icon' alt='" . __('關閉', 'affiliates') . "' src='" . AFFILIATES_PRO_PLUGIN_URL . "images/closed.png'/>", AFFILIATES_REFERRAL_STATUS_PENDING => "<img class='icon' alt='" . __('待辦的', 'affiliates') . "' src='" . AFFILIATES_PRO_PLUGIN_URL . "images/pending.png'/>", AFFILIATES_REFERRAL_STATUS_REJECTED => "<img class='icon' alt='" . __('拒絕', 'affiliates') . "' src='" . AFFILIATES_PRO_PLUGIN_URL . "images/rejected.png'/>", ); $IX94019 .= '<table id="referrals" class="referrals wp-list-table widefat fixed" cellspacing="0">'; $IX94019 .= "<thead>"; $IX94019 .= "<tr>"; foreach ( $IX92845 as $IX38286 => $IX72529 ) { $IX94019 .= "<th scope='col'>$IX72529</th>"; } $IX94019 .= "</tr>"; $IX94019 .= "</thead>"; $IX94019 .= "<tbody>"; if ( count( $results ) > 0 ) { for ( $IX71405 = 0; $IX71405 < count( $results ); $IX71405++ ) { $IX24651 = $results[$IX71405]; $IX94019 .= '<tr class="details-referrals ' . ( $IX71405 % 2 == 0 ? 'even' : 'odd' ) . '">'; $IX94019 .= '<td class="datetime">' . DateHelper::s2u( $IX24651->datetime ) . '</td>'; $IX90030 = get_the_title( $IX24651->post_id ); $IX94019 .= '<td class="post_title">' . wp_filter_nohtml_kses( $IX90030 ) . '</td>'; $IX94019 .= "<td class='name'>" . stripslashes( wp_filter_nohtml_kses( $IX24651->name ) ) . "</td>"; $IX94019 .= "<td class='amount'>" . stripslashes( wp_filter_nohtml_kses( $IX24651->amount ) ) . "</td>"; $IX94019 .= "<td class='currency_id'>" . stripslashes( wp_filter_nohtml_kses( $IX24651->currency_id ) ) . "</td>"; $IX94019 .= "<td class='status'>"; $IX94019 .= isset( $IX37593[$IX24651->status] ) ? $IX37593[$IX24651->status] : ''; $IX94019 .= isset( $IX41766[$IX24651->status] ) ? $IX41766[$IX24651->status] : ''; $IX94019 .= "</td>"; $IX94019 .= '</tr>'; } } else { $IX94019 .= '<tr><td colspan="' . count( $IX92845 ) . '">' . __('沒有結果。', AFFILIATES_PLUGIN_DOMAIN ) . '</td></tr>'; } $IX94019 .= '</tbody>'; $IX94019 .= '</table>'; return $IX94019; }
}
